(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue")):"function"===typeof define&&define.amd?define(["CoreHome"],t):"object"===typeof exports?exports["MultiSites"]=t(require("CoreHome"),require("vue")):e["MultiSites"]=t(e["CoreHome"],e["Vue"])})("undefined"!==typeof self?self:this,(function(e,t){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="plugins/MultiSites/vue/dist/",i(i.s="fae3")}({"19dc":function(t,i){t.exports=e},"8bbf":function(e,i){e.exports=t},b7b0:function(e,t){},fae3:function(e,t,i){"use strict";if(i.r(t),i.d(t,"MultisitesSite",(function(){return G})),i.d(t,"DashboadStore",(function(){return W})),"undefined"!==typeof window){var r=window.document.currentScript,n=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(i.p=n[1])}var a=i("19dc"),o=i("8bbf"),s={key:0,class:"multisites-label label"},l=["href"],c=["href","title"],u=Object(o["createElementVNode"])("span",{class:"icon icon-outlink"},null,-1),b=[u],p={key:1,class:"multisites-label label"},v={class:"value"},d={class:"multisites-column"},m={class:"value"},f={class:"multisites-column"},h={class:"value"},g={key:2,class:"multisites-column"},O={class:"value"},S=["title"],j={key:0,class:"visits value"},_=Object(o["createElementVNode"])("img",{class:"multisites_icon",src:"plugins/MultiSites/images/arrow_up.png",alt:""},null,-1),w=Object(o["createTextVNode"])(),y={style:{color:"green"}},k=Object(o["createElementVNode"])("img",{class:"multisites_icon",src:"plugins/MultiSites/images/stop.png",alt:""},null,-1),C=Object(o["createTextVNode"])(),M=Object(o["createElementVNode"])("img",{class:"multisites_icon",src:"plugins/MultiSites/images/arrow_down.png",alt:""},null,-1),E=Object(o["createTextVNode"])(),N={style:{color:"red"}},V={key:4,style:{width:"180px"}},P={key:0,class:"sparkline",style:{width:"100px",margin:"auto"}},B=["href","title"],x=["src"];function A(e,t,i,r,n,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{class:Object(o["normalizeClass"])({groupedWebsite:e.website.group,website:!e.website.group,group:e.website.isGroup})},[e.website.isGroup?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",s,[Object(o["createElementVNode"])("a",{title:"View reports",class:"value truncated-text-line",href:e.dashboardUrl(e.website)},Object(o["toDisplayString"])(e.websiteLabel),9,l),Object(o["createElementVNode"])("span",null,[Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.website.main_url,title:e.translate("General_GoTo",e.website.main_url)},b,8,c)])])),e.website.isGroup?(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",p,[Object(o["createElementVNode"])("span",v,Object(o["toDisplayString"])(e.websiteLabel),1)])):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("td",d,[Object(o["createElementVNode"])("span",m,Object(o["toDisplayString"])(e.website.nb_visits),1)]),Object(o["createElementVNode"])("td",f,[Object(o["createElementVNode"])("span",h,Object(o["toDisplayString"])(e.website.nb_pageviews),1)]),e.displayRevenueColumn?(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",g,[Object(o["createElementVNode"])("span",O,Object(o["toDisplayString"])(e.website.revenue),1)])):Object(o["createCommentVNode"])("",!0),"range"!==e.period?(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",{key:3,class:"multisites-evolution",title:e.website.tooltip},[e.website.isGroup?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",j,[Object(o["withDirectives"])(Object(o["createElementVNode"])("span",null,[_,w,Object(o["createElementVNode"])("span",y,Object(o["toDisplayString"])(e.website[e.evolutionMetric]),1)],512),[[o["vShow"],1===e.website["".concat(e.evolutionMetric,"_trend")]]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",null,[k,C,Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(e.website[e.evolutionMetric]),1)],512),[[o["vShow"],0===e.website["".concat(e.evolutionMetric,"_trend")]]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",null,[M,E,Object(o["createElementVNode"])("span",N,Object(o["toDisplayString"])(e.website[e.evolutionMetric]),1)],512),[[o["vShow"],-1===e.website["".concat(e.evolutionMetric,"_trend")]]])]))],8,S)):Object(o["createCommentVNode"])("",!0),e.showSparklines?(Object(o["openBlock"])(),Object(o["createElementBlock"])("td",V,[e.website.isGroup?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",P,[Object(o["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.dashboardUrl(e.website),title:e.translate("General_GoTo",e.translate("Dashboard_DashboardOf",e.websiteLabel))},[Object(o["createElementVNode"])("img",{alt:"",width:"100",height:"25",src:e.sparklineImage(e.website)},null,8,x)],8,B)]))])):Object(o["createCommentVNode"])("",!0)],2)}var D=Object(o["defineComponent"])({props:{website:{type:Object,required:!0},evolutionMetric:{type:String,required:!0},showSparklines:Boolean,dateSparkline:String,displayRevenueColumn:Boolean,metric:String},methods:{dashboardUrl:function(e){return"index.php?module=CoreHome&action=index&date=".concat(this.date,"&period=").concat(this.period)+"&idSite=".concat(e.idsite).concat(this.tokenParam)},sparklineImage:function(e){var t=this.metric;switch(this.evolutionMetric){case"visits_evolution":t="nb_visits";break;case"pageviews_evolution":t="nb_pageviews";break;case"revenue_evolution":t="revenue";break;default:break}return"index.php?module=MultiSites&action=getEvolutionGraph&period=".concat(this.period,"&date=")+"".concat(this.dateSparkline,"&evolutionBy=").concat(t,"&columns=").concat(t,"&idSite=").concat(e.idsite)+"&idsite=".concat(e.idsite,"&viewDataTable=sparkline").concat(this.tokenParam,"&colors=")+"".concat(encodeURIComponent(JSON.stringify(a["Matomo"].getSparklineColors())))}},computed:{tokenParam:function(){var e=a["MatomoUrl"].urlParsed.value.token_auth;return e.length?"&token_auth=".concat(e):""},period:function(){return a["Matomo"].period},date:function(){return a["MatomoUrl"].urlParsed.value.date},websiteLabel:function(){return a["Matomo"].helper.htmlDecode(this.website.label)}}}),T=i("b7b0"),I=i.n(T);D.render=A,"function"===typeof I.a&&I()(D);var G=D;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(a["createAngularJsAdapter"])({component:G,scope:{website:{angularJsBind:"="},evolutionMetric:{angularJsBind:"="},showSparklines:{angularJsBind:"="},dateSparkline:{angularJsBind:"="},displayRevenueColumn:{angularJsBind:"="},metric:{angularJsBind:"="}},directiveName:"piwikMultisitesSite"});function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J(e,t,i){return t&&R(e.prototype,t),i&&R(e,i),e}function U(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var q=window,z=q.NumberFormatter,H=function(){function e(){var t=this;L(this,e),U(this,"privateState",Object(o["reactive"])({sites:[],isLoading:!1,pageSize:25,currentPage:0,totalVisits:"?",totalPageviews:"?",totalActions:"?",totalRevenue:"?",searchTerm:"",lastVisits:"?",lastVisitsDate:"?",numberOfSites:0,loadingMessage:Object(a["translate"])("MultiSites_LoadingWebsites"),reverse:!0,sortColumn:"nb_visits",refreshInterval:0,errorLoadingSites:!1})),U(this,"refreshTimeout",null),U(this,"fetchAbort",null),U(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),U(this,"numberOfFilteredSites",Object(o["computed"])((function(){return t.state.value.numberOfSites}))),U(this,"numberOfPages",Object(o["computed"])((function(){return Math.ceil(t.numberOfFilteredSites.value/t.state.value.pageSize-1)}))),U(this,"currentPagingOffset",Object(o["computed"])((function(){return Math.ceil(t.state.value.currentPage*t.state.value.pageSize)}))),U(this,"paginationLowerBound",Object(o["computed"])((function(){return t.currentPagingOffset.value+1}))),U(this,"paginationUpperBound",Object(o["computed"])((function(){var e=t.currentPagingOffset.value+t.state.value.pageSize,i=t.numberOfFilteredSites.value;return e>i&&(e=i),e})))}return J(e,[{key:"cancelRefereshInterval",value:function(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null)}},{key:"updateWebsitesList",value:function(e){var t=this;if(e){var i=e.sites;i.forEach((function(e){if(1!==e.ratio&&"1"!==e.ratio){var i=z.formatPercent(Math.round(100*parseInt(e.ratio,10))),r=null,n="0",o="0",s="0",l="0";if("nb_visits"!==t.state.value.sortColumn&&"visits_evolution"!==t.state.value.sortColumn||(n=z.formatNumber(e.previous_nb_visits),o=z.formatNumber(e.nb_visits),s=z.formatPercent(e.visits_evolution),r=Object(a["translate"])("General_ColumnNbVisits"),l=z.formatNumber(Math.round(parseInt(e.previous_nb_visits,10)*parseInt(e.ratio,10)))),"pageviews_evolution"===t.state.value.sortColumn&&(n="".concat(e.previous_Actions_nb_pageviews),o="".concat(e.nb_pageviews),s=z.formatPercent(e.pageviews_evolution),r=Object(a["translate"])("General_ColumnPageviews"),l=z.formatNumber(Math.round(parseInt(e.previous_Actions_nb_pageviews,10)*parseInt(e.ratio,10)))),"revenue_evolution"===t.state.value.sortColumn&&(n=z.formatCurrency(e.previous_Goal_revenue,e.currencySymbol),o=z.formatCurrency(e.revenue,e.currencySymbol),s=z.formatPercent(e.revenue_evolution),r=Object(a["translate"])("General_ColumnRevenue"),l=z.formatCurrency(Math.round(parseInt(e.previous_Goal_revenue,10)*parseInt(e.ratio,10)),e.currencySymbol)),r)switch(e.tooltip="".concat(Object(a["translate"])("MultiSites_EvolutionComparisonIncomplete",[i]),"\n"),e.tooltip+="".concat(Object(a["translate"])("MultiSites_EvolutionComparisonProportional",[i,"".concat(l),r,"".concat(n)]),"\n"),e.periodName){case"day":e.tooltip+=Object(a["translate"])("MultiSites_EvolutionComparisonDay",["".concat(o),r,"".concat(l),e.previousRange,"".concat(s)]);break;case"week":e.tooltip+=Object(a["translate"])("MultiSites_EvolutionComparisonWeek",["".concat(o),r,"".concat(l),e.previousRange,"".concat(s)]);break;case"month":e.tooltip+=Object(a["translate"])("MultiSites_EvolutionComparisonMonth",["".concat(o),r,"".concat(l),e.previousRange,"".concat(s)]);break;case"year":e.tooltip+=Object(a["translate"])("MultiSites_EvolutionComparisonYear",["".concat(o),r,"".concat(l),e.previousRange,"".concat(s)]);break;default:break}}})),this.privateState.totalVisits=e.totals.nb_visits,this.privateState.totalPageviews=e.totals.nb_pageviews,this.privateState.totalActions=e.totals.nb_actions,this.privateState.totalRevenue=e.totals.revenue,this.privateState.lastVisits=e.totals.nb_visits_lastdate,this.privateState.sites=i,this.privateState.numberOfSites=e.numSites,this.privateState.lastVisitsDate=e.lastDate}else this.onError()}},{key:"sortBy",value:function(e){this.state.value.sortColumn===e&&(this.privateState.reverse=!this.state.value.reverse),this.privateState.sortColumn=e,this.fetchAllSites()}},{key:"previousPage",value:function(){this.privateState.currentPage=this.state.value.currentPage-1,this.fetchAllSites()}},{key:"nextPage",value:function(){this.privateState.currentPage=this.state.value.currentPage+1,this.fetchAllSites()}},{key:"searchSite",value:function(e){this.privateState.searchTerm=e,this.privateState.currentPage=0,this.fetchAllSites()}},{key:"fetchAllSites",value:function(){var e=this;this.fetchAbort&&(this.fetchAbort.abort(),this.fetchAbort=null,this.cancelRefereshInterval()),this.privateState.isLoading=!0,this.privateState.errorLoadingSites=!1;var t={module:"MultiSites",action:"getAllWithGroups",hideMetricsDoc:"1",filter_sort_order:"asc",filter_limit:this.state.value.pageSize,filter_offset:this.currentPagingOffset.value,showColumns:["label","nb_visits","nb_pageviews","visits_evolution","visits_evolution_trend","pageviews_evolution","pageviews_evolution_trend","revenue_evolution","revenue_evolution_trend","nb_actions,revenue"].join(",")};return this.privateState.searchTerm&&(t.pattern=this.privateState.searchTerm),this.privateState.sortColumn&&(t.filter_sort_column=this.privateState.sortColumn),this.privateState.reverse&&(t.filter_sort_order="desc"),this.fetchAbort=new AbortController,a["AjaxHelper"].fetch(t,{abortController:this.fetchAbort}).then((function(t){e.updateWebsitesList(t)})).catch((function(){e.onError()})).finally((function(){e.privateState.isLoading=!1,e.fetchAbort=null,e.state.value.refreshInterval&&e.state.value.refreshInterval>0&&(e.cancelRefereshInterval(),e.refreshTimeout=setTimeout((function(){e.refreshTimeout=null,e.fetchAllSites()}),1e3*e.state.value.refreshInterval))}))}},{key:"onError",value:function(){this.privateState.errorLoadingSites=!0,this.privateState.sites=[]}}]),e}(),W=new H}})}));
//# sourceMappingURL=MultiSites.umd.min.js.map