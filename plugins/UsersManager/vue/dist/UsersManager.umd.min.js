(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["UsersManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["UsersManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,i){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="plugins/UsersManager/vue/dist/",i(i.s="fae3")}({"19dc":function(t,i){t.exports=e},"8bbf":function(e,i){e.exports=t},a5a2:function(e,t){e.exports=i},fae3:function(e,t,i){"use strict";if(i.r(t),i.d(t,"CapabilitiesEdit",(function(){return S})),i.d(t,"UserPermissionsEdit",(function(){return Ue})),"undefined"!==typeof window){var n=window.document.currentScript,s=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);s&&(i.p=s[1])}var l=i("19dc"),c=i("8bbf"),a={key:0,class:"chip"},o=["title"],r=["onClick"],d={key:0,class:"addCapability"},u={class:"ui-confirm confirmCapabilityToggle modal",ref:"confirmCapabilityToggleModal"},b={class:"modal-content"},m=["innerHTML"],p=["innerHTML"],f={class:"modal-footer"};function h(e,t,i,n,s,l){var h=Object(c["resolveComponent"])("Field");return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{class:Object(c["normalizeClass"])(["capabilitiesEdit",{busy:e.isBusy}])},[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(e.availableCapabilities,(function(t){return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{key:t.id},[e.capabilitiesSet[t.id]?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",a,[Object(c["createElementVNode"])("span",{class:"capability-name",title:"".concat(t.description," ").concat(e.isIncludedInRole(t)?"<br/><br/>".concat(e.translate("UsersManager_IncludedInUsersRole")):"")},Object(c["toDisplayString"])(t.category)+": "+Object(c["toDisplayString"])(t.name),9,o),e.isIncludedInRole(t)?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createElementBlock"])("span",{key:0,class:"icon-close",onClick:function(i){e.capabilityToRemoveId=t.id,e.onToggleCapability(!1)}},null,8,r))])):Object(c["createCommentVNode"])("",!0)])})),128)),e.availableCapabilitiesGrouped.length?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",d,[Object(c["createVNode"])(h,{"model-value":e.capabilityToAddId,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.capabilityToAddId=t,e.onToggleCapability(!0)}),disabled:e.isBusy,uicontrol:"expandable-select",name:"add_capability","full-width":!0,options:e.availableCapabilitiesGrouped},null,8,["model-value","disabled","options"])])):Object(c["createCommentVNode"])("",!0),Object(c["createElementVNode"])("div",u,[Object(c["createElementVNode"])("div",b,[e.isAddingCapability?(Object(c["openBlock"])(),Object(c["createElementBlock"])("h2",{key:0,innerHTML:e.confirmAddCapabilityToggleContent},null,8,m)):Object(c["createCommentVNode"])("",!0),e.isAddingCapability?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createElementBlock"])("h2",{key:1,innerHTML:e.confirmCapabilityToggleContent},null,8,p))]),Object(c["createElementVNode"])("div",f,[Object(c["createElementVNode"])("a",{href:"",class:"modal-action modal-close btn",onClick:t[1]||(t[1]=Object(c["withModifiers"])((function(t){return e.toggleCapability()}),["prevent"]))},Object(c["toDisplayString"])(e.translate("General_Yes")),1),Object(c["createElementVNode"])("a",{href:"",class:"modal-action modal-close modal-no",onClick:t[2]||(t[2]=Object(c["withModifiers"])((function(t){e.capabilityToAddOrRemove=null,e.capabilityToAddId=null,e.capabilityToRemoveId=null}),["prevent"]))},Object(c["toDisplayString"])(e.translate("General_No")),1)])],512)],2)}var g=i("a5a2");function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,i){return t&&j(e.prototype,t),i&&j(e,i),e}function C(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var A=function(){function e(){var t=this;O(this,e),C(this,"privateState",Object(c["reactive"])({isLoading:!1,capabilities:[]})),C(this,"state",Object(c["computed"])((function(){return Object(c["readonly"])(t.privateState)}))),C(this,"capabilities",Object(c["computed"])((function(){return t.state.value.capabilities}))),C(this,"isLoading",Object(c["computed"])((function(){return t.state.value.isLoading}))),C(this,"fetchPromise",void 0),this.fetchCapabilities()}return v(e,[{key:"fetchCapabilities",value:function(){var e=this;return this.fetchPromise||(this.privateState.isLoading=!0,this.fetchPromise=l["AjaxHelper"].fetch({method:"UsersManager.getAvailableCapabilities"}).then((function(t){return e.privateState.capabilities=t,e.capabilities.value})).finally((function(){e.privateState.isLoading=!1}))),this.fetchPromise}}]),e}(),y=Object(l["lazyInitSingleton"])(A),T=window,E=T.$,N=Object(c["defineComponent"])({props:{idsite:[String,Number],siteName:{type:String,required:!0},userLogin:{type:String,required:!0},userRole:{type:String,required:!0},capabilities:Array},components:{Field:g["Field"]},data:function(){return{theCapabilities:this.capabilities||[],isBusy:!1,isAddingCapability:!1,capabilityToAddId:null,capabilityToRemoveId:null,capabilityToAddOrRemove:null}},emits:["change"],watch:{capabilities:function(e){e&&(this.theCapabilities=e)}},created:function(){var e=this;this.capabilities?this.theCapabilities=this.capabilities:(this.isBusy=!0,l["AjaxHelper"].fetch({method:"UsersManager.getUsersPlusRole",limit:"1",filter_search:this.userLogin}).then((function(e){return e&&e.capabilities?e.capabilities:[]})).then((function(t){e.theCapabilities=t})).finally((function(){e.isBusy=!1})))},methods:{onToggleCapability:function(e){var t=this;this.isAddingCapability=e;var i=e?this.capabilityToAddId:this.capabilityToRemoveId;this.capabilityToAddOrRemove=null,this.availableCapabilities.forEach((function(e){e.id===i&&(t.capabilityToAddOrRemove=e)})),this.$refs.confirmCapabilityToggleModal&&E(this.$refs.confirmCapabilityToggleModal).modal({dismissible:!1,yes:function(){return null}}).modal("open")},toggleCapability:function(){this.isAddingCapability?this.addCapability(this.capabilityToAddOrRemove):this.removeCapability(this.capabilityToAddOrRemove)},isIncludedInRole:function(e){return-1!==(e.includedInRoles||[]).indexOf(this.userRole)},getCapabilitiesList:function(){var e=this,t=[];return this.availableCapabilities.forEach((function(i){e.isIncludedInRole(i)||e.capabilitiesSet[i.id]&&t.push(i.id)})),t},addCapability:function(e){var t=this;this.isBusy=!0,l["AjaxHelper"].post({method:"UsersManager.addCapabilities"},{userLogin:this.userLogin,capabilities:e.id,idSites:this.idsite}).then((function(){t.$emit("change",t.getCapabilitiesList())})).finally((function(){t.isBusy=!1,t.capabilityToAddOrRemove=null,t.capabilityToAddId=null,t.capabilityToRemoveId=null}))},removeCapability:function(e){var t=this;this.isBusy=!0,l["AjaxHelper"].post({method:"UsersManager.removeCapabilities"},{userLogin:this.userLogin,capabilities:e.id,idSites:this.idsite}).then((function(){t.$emit("change",t.getCapabilitiesList())})).finally((function(){t.isBusy=!1,t.capabilityToAddOrRemove=null,t.capabilityToAddId=null,t.capabilityToRemoveId=null}))}},computed:{availableCapabilities:function(){return y.capabilities.value},confirmAddCapabilityToggleContent:function(){return Object(l["translate"])("UsersManager_AreYouSureAddCapability","<strong>".concat(this.userLogin,"</strong>"),"<strong>".concat(this.capabilityToAddOrRemove?this.capabilityToAddOrRemove.name:"","</strong>"),"<strong>".concat(this.siteName,"</strong>"))},confirmCapabilityToggleContent:function(){return Object(l["translate"])("UsersManager_AreYouSureRemoveCapability","<strong>".concat(this.capabilityToAddOrRemove?this.capabilityToAddOrRemove.name:"","</strong>"),"<strong>".concat(this.userLogin,"</strong>"),"<strong>".concat(this.siteName,"</strong>"))},availableCapabilitiesGrouped:function(){var e=this,t=this.availableCapabilities.filter((function(t){return!e.capabilitiesSet[t.id]})).map((function(e){return{group:e.category,key:e.id,value:e.name,tooltip:e.description}}));return t.sort((function(e,t){return e.group===t.group?e.value===t.value?0:e.value<t.value?-1:1:e.group<t.group?-1:1})),t},capabilitiesSet:function(){var e=this,t={},i=this.theCapabilities;return(i||[]).forEach((function(e){t[e]=!0})),(this.availableCapabilities||[]).forEach((function(i){e.isIncludedInRole(i)&&(t[i.id]=!0)})),t}}});N.render=h;var S=N,k=(Object(l["createAngularJsAdapter"])({component:S,scope:{idsite:{angularJsBind:"<"},siteName:{angularJsBind:"<"},userLogin:{angularJsBind:"<"},userRole:{angularJsBind:"<"},capabilities:{angularJsBind:"<"},onCapabilitiesChange:{angularJsBind:"&",vue:"change"}},directiveName:"piwikCapabilitiesEdit",restrict:"E",$inject:["$timeout"],events:{change:function(e,t,i,n,s,l,c){c((function(){i.onCapabilitiesChange&&i.onCapabilitiesChange.call({capabilities:e})}))}}}),{key:0,class:"row"}),V={class:"row to-all-websites"},M={class:"col s12"},L={id:"all-sites-access-select"},w=Object(c["createElementVNode"])("p",null," ",-1),B={class:"filters row"},R={class:"col s12 m12 l8"},x={class:"input-field bulk-actions"},_={id:"user-permissions-edit-bulk-actions",class:"dropdown-content"},U={class:"dropdown-trigger","data-target":"user-permissions-bulk-set-access"},D={id:"user-permissions-bulk-set-access",class:"dropdown-content"},H=["onClick"],P={class:"input-field site-filter"},I=["value","placeholder"],F={class:"input-field access-filter"},G={key:0,class:"col s12 m12 l4 sites-for-permission-pagination-container"},$={class:"sites-for-permission-pagination"},W={class:"counter"},z={class:"roles-help-notification"},q=["innerHTML"],J={class:"capabilities-help-notification"},Y={id:"sitesForPermission"},K={class:"select-cell"},Q={class:"checkbox-container"},X=["checked"],Z=Object(c["createElementVNode"])("span",null,null,-1),ee={class:"role_header"},te=Object(c["createElementVNode"])("span",{class:"icon-help"},null,-1),ie=[te],ne={class:"capabilities_header"},se=Object(c["createElementVNode"])("span",{class:"icon-help"},null,-1),le=[se],ce={key:0,class:"select-all-row"},ae={colspan:"4"},oe={key:0},re=["innerHTML"],de=["innerHTML"],ue={key:1},be=["innerHTML"],me=["innerHTML"],pe={class:"select-cell"},fe={class:"checkbox-container"},he=["id","onUpdate:modelValue"],ge=Object(c["createElementVNode"])("span",null,null,-1),Oe={class:"role-select"},je={class:"delete-access-confirm-modal modal",ref:"deleteAccessConfirmModal"},ve={class:"modal-content"},Ce=["innerHTML"],Ae=["innerHTML"],ye={class:"modal-footer"},Te={class:"change-access-confirm-modal modal",ref:"changeAccessConfirmModal"},Ee={class:"modal-content"},Ne=["innerHTML"],Se=["innerHTML"],ke={class:"modal-footer"},Ve={class:"confirm-give-access-all-sites modal",ref:"confirmGiveAccessAllSites"},Me={class:"modal-content"},Le=["innerHTML"],we={class:"modal-footer"};
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function Be(e,t,i,n,s,l){var a=Object(c["resolveComponent"])("Notification"),o=Object(c["resolveComponent"])("Field"),r=Object(c["resolveComponent"])("CapabilitiesEdit"),d=Object(c["resolveDirective"])("dropdown-menu"),u=Object(c["resolveDirective"])("content-table");return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{class:Object(c["normalizeClass"])(["userPermissionsEdit",{loading:e.isLoadingAccess}])},[e.hasAccessToAtLeastOneSite?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",k,[Object(c["createElementVNode"])("div",null,[Object(c["createVNode"])(a,{context:"warning",type:"transient",noclear:!0},{default:Object(c["withCtx"])((function(){return[Object(c["createElementVNode"])("strong",null,Object(c["toDisplayString"])(e.translate("General_Warning"))+":",1),Object(c["createTextVNode"])(" "+Object(c["toDisplayString"])(e.translate("UsersManager_NoAccessWarning")),1)]})),_:1})])])),Object(c["createElementVNode"])("div",V,[Object(c["createElementVNode"])("div",M,[Object(c["createElementVNode"])("div",null,[Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.translate("UsersManager_GiveAccessToAll"))+":",1),Object(c["createElementVNode"])("div",L,[Object(c["createVNode"])(o,{modelValue:e.allWebsitesAccssLevelSet,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.allWebsitesAccssLevelSet=t}),uicontrol:"select",options:e.filteredAccessLevels,"full-width":!0},null,8,["modelValue","options"])]),Object(c["createElementVNode"])("a",{href:"",class:Object(c["normalizeClass"])(["btn",{disabled:e.isGivingAccessToAllSites}]),onClick:t[1]||(t[1]=Object(c["withModifiers"])((function(t){return e.showChangeAccessAllSitesModal()}),["prevent"]))},Object(c["toDisplayString"])(e.translate("General_Apply")),3)]),w,Object(c["createElementVNode"])("p",null,Object(c["toDisplayString"])(e.translate("UsersManager_OrManageIndividually"))+":",1)])]),Object(c["createElementVNode"])("div",B,[Object(c["createElementVNode"])("div",R,[Object(c["createElementVNode"])("div",x,[Object(c["withDirectives"])(Object(c["createElementVNode"])("a",{class:Object(c["normalizeClass"])(["dropdown-trigger btn",{disabled:e.isBulkActionsDisabled}]),href:"","data-target":"user-permissions-edit-bulk-actions"},[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.translate("UsersManager_BulkActions")),1)],2),[[d,{activates:"#user-permissions-edit-bulk-actions"}]]),Object(c["createElementVNode"])("ul",_,[Object(c["createElementVNode"])("li",null,[Object(c["withDirectives"])(Object(c["createElementVNode"])("a",U,[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.translate("UsersManager_SetPermission")),1)],512),[[d,{activates:"#user-permissions-bulk-set-access"}]]),Object(c["createElementVNode"])("ul",D,[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(e.filteredAccessLevels,(function(t){return Object(c["openBlock"])(),Object(c["createElementBlock"])("li",{key:t.key},[Object(c["createElementVNode"])("a",{href:"",onClick:Object(c["withModifiers"])((function(i){e.siteAccessToChange=null,e.roleToChangeTo=t.key,e.showChangeAccessConfirm()}),["prevent"])},Object(c["toDisplayString"])(t.value),9,H)])})),128))])]),Object(c["createElementVNode"])("li",null,[Object(c["createElementVNode"])("a",{href:"",onClick:t[2]||(t[2]=Object(c["withModifiers"])((function(t){e.siteAccessToChange=null,e.roleToChangeTo="noaccess",e.showRemoveAccessConfirm()}),["prevent"]))},Object(c["toDisplayString"])(e.translate("UsersManager_RemovePermissions")),1)])])]),Object(c["createElementVNode"])("div",P,[Object(c["createElementVNode"])("input",{type:"text",value:e.siteNameFilter,onKeydown:t[3]||(t[3]=function(t){e.onChangeSiteFilter(t)}),placeholder:e.translate("UsersManager_FilterByWebsite")},null,40,I)]),Object(c["createElementVNode"])("div",F,[Object(c["createElementVNode"])("div",null,[Object(c["createVNode"])(o,{modelValue:e.accessLevelFilter,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.accessLevelFilter=t}),uicontrol:"select",options:e.filteredSelectAccessLevels,"full-width":!0,placeholder:e.translate("UsersManager_FilterByAccess")},null,8,["modelValue","options","placeholder"])])])]),e.totalEntries>e.limit?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",G,[Object(c["createElementVNode"])("div",$,[Object(c["createElementVNode"])("a",{class:Object(c["normalizeClass"])(["prev",{disabled:e.offset<=0}])},[Object(c["createElementVNode"])("span",{class:"pointer",onClick:t[5]||(t[5]=function(t){return e.gotoPreviousPage()})},"« "+Object(c["toDisplayString"])(e.translate("General_Previous")),1)],2),Object(c["createElementVNode"])("span",W,[Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.translate("General_Pagination",e.paginationLowerBound,e.paginationUpperBound,e.totalEntries)),1)]),Object(c["createElementVNode"])("a",{class:Object(c["normalizeClass"])(["next",{disabled:e.offset+e.limit>=e.totalEntries}])},[Object(c["createElementVNode"])("span",{class:"pointer",onClick:t[6]||(t[6]=function(t){return e.gotoNextPage()})},Object(c["toDisplayString"])(e.translate("General_Next"))+" »",1)],2)])])):Object(c["createCommentVNode"])("",!0)]),Object(c["createElementVNode"])("div",z,[e.isRoleHelpToggled?(Object(c["openBlock"])(),Object(c["createBlock"])(a,{key:0,context:"info",type:"persistent",noclear:!0},{default:Object(c["withCtx"])((function(){return[Object(c["createElementVNode"])("span",{innerHTML:e.$sanitize(e.rolesHelpText)},null,8,q)]})),_:1})):Object(c["createCommentVNode"])("",!0)]),Object(c["createElementVNode"])("div",J,[e.isCapabilitiesHelpToggled?(Object(c["openBlock"])(),Object(c["createBlock"])(a,{key:0,context:"info",type:"persistent",noclear:!0},{default:Object(c["withCtx"])((function(){return[Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.translate("UsersManager_CapabilitiesHelp")),1)]})),_:1})):Object(c["createCommentVNode"])("",!0)]),Object(c["withDirectives"])(Object(c["createElementVNode"])("table",Y,[Object(c["createElementVNode"])("thead",null,[Object(c["createElementVNode"])("tr",null,[Object(c["createElementVNode"])("th",K,[Object(c["createElementVNode"])("span",Q,[Object(c["createElementVNode"])("label",null,[Object(c["createElementVNode"])("input",{type:"checkbox",id:"perm_edit_select_all",checked:e.isAllCheckboxSelected,onChange:t[7]||(t[7]=function(t){return e.onAllCheckboxChange(t)})},null,40,X),Z])])]),Object(c["createElementVNode"])("th",null,Object(c["toDisplayString"])(e.translate("General_Name")),1),Object(c["createElementVNode"])("th",ee,[Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.translate("UsersManager_Role")),1),Object(c["createElementVNode"])("a",{href:"",class:Object(c["normalizeClass"])(["helpIcon",{sticky:e.isRoleHelpToggled}]),onClick:t[8]||(t[8]=Object(c["withModifiers"])((function(t){return e.isRoleHelpToggled=!e.isRoleHelpToggled}),["prevent"]))},ie,2)]),Object(c["createElementVNode"])("th",ne,[Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.translate("UsersManager_Capabilities")),1),Object(c["createElementVNode"])("a",{href:"",class:Object(c["normalizeClass"])(["helpIcon",{sticky:e.isCapabilitiesHelpToggled}]),onClick:t[9]||(t[9]=Object(c["withModifiers"])((function(t){return e.isCapabilitiesHelpToggled=!e.isCapabilitiesHelpToggled}),["prevent"]))},le,2)])])]),Object(c["createElementVNode"])("tbody",null,[e.isAllCheckboxSelected&&e.siteAccess.length<e.totalEntries?(Object(c["openBlock"])(),Object(c["createElementBlock"])("tr",ce,[Object(c["createElementVNode"])("td",ae,[e.areAllResultsSelected?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",oe,[Object(c["createElementVNode"])("span",{innerHTML:e.$sanitize(e.theDisplayedWebsitesAreSelectedText)},null,8,re),Object(c["createElementVNode"])("a",{href:"#",onClick:t[10]||(t[10]=Object(c["withModifiers"])((function(t){return e.areAllResultsSelected=!e.areAllResultsSelected}),["prevent"])),innerHTML:e.$sanitize(e.clickToSelectAllText)},null,8,de)])),e.areAllResultsSelected?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",ue,[Object(c["createElementVNode"])("span",{innerHTML:e.$sanitize(e.allWebsitesAreSelectedText)},null,8,be),Object(c["createElementVNode"])("a",{href:"#",onClick:t[11]||(t[11]=Object(c["withModifiers"])((function(t){return e.areAllResultsSelected=!e.areAllResultsSelected}),["prevent"])),innerHTML:e.$sanitize(e.clickToSelectDisplayedWebsitesText)},null,8,me)])):Object(c["createCommentVNode"])("",!0)])])):Object(c["createCommentVNode"])("",!0),(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(e.siteAccess,(function(i,n){return Object(c["openBlock"])(),Object(c["createElementBlock"])("tr",{key:i.idsite},[Object(c["createElementVNode"])("td",pe,[Object(c["createElementVNode"])("span",fe,[Object(c["createElementVNode"])("label",null,[Object(c["withDirectives"])(Object(c["createElementVNode"])("input",{type:"checkbox",id:"perm_edit_select_row".concat(n),"onUpdate:modelValue":function(t){return e.selectedRows[n]=t},onClick:t[12]||(t[12]=function(t){return e.onRowSelected()})},null,8,he),[[c["vModelCheckbox"],e.selectedRows[n]]]),ge])])]),Object(c["createElementVNode"])("td",null,[Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(i.site_name),1)]),Object(c["createElementVNode"])("td",null,[Object(c["createElementVNode"])("div",Oe,[Object(c["createVNode"])(o,{"model-value":i.role,"onUpdate:modelValue":function(t){e.onRoleChange(i,t)},uicontrol:"select",options:e.filteredAccessLevels,"full-width":!0},null,8,["model-value","onUpdate:modelValue","options"])])]),Object(c["createElementVNode"])("td",null,[Object(c["createElementVNode"])("div",null,[Object(c["createVNode"])(r,{idsite:i.idsite,"site-name":i.site_name,"user-login":e.userLogin,"user-role":i.role,capabilities:i.capabilities,onChange:t[13]||(t[13]=function(t){return e.fetchAccess()})},null,8,["idsite","site-name","user-login","user-role","capabilities"])])])])})),128))])],512),[[u]]),Object(c["createElementVNode"])("div",je,[Object(c["createElementVNode"])("div",ve,[e.siteAccessToChange?(Object(c["openBlock"])(),Object(c["createElementBlock"])("h3",{key:0,innerHTML:e.$sanitize(e.deletePermConfirmSingleText)},null,8,Ce)):Object(c["createCommentVNode"])("",!0),e.siteAccessToChange?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createElementBlock"])("p",{key:1,innerHTML:e.$sanitize(e.deletePermConfirmMultipleText)},null,8,Ae))]),Object(c["createElementVNode"])("div",ye,[Object(c["createElementVNode"])("a",{href:"",class:"modal-action modal-close btn",onClick:t[14]||(t[14]=Object(c["withModifiers"])((function(t){return e.changeUserRole()}),["prevent"]))},Object(c["toDisplayString"])(e.translate("General_Yes")),1),Object(c["createElementVNode"])("a",{href:"",class:"modal-action modal-close modal-no",onClick:t[15]||(t[15]=Object(c["withModifiers"])((function(t){e.siteAccessToChange=null,e.roleToChangeTo=null}),["prevent"]))},Object(c["toDisplayString"])(e.translate("General_No")),1)])],512),Object(c["createElementVNode"])("div",Te,[Object(c["createElementVNode"])("div",Ee,[e.siteAccessToChange?(Object(c["openBlock"])(),Object(c["createElementBlock"])("h3",{key:0,innerHTML:e.$sanitize(e.changePermToSiteConfirmSingleText)},null,8,Ne)):Object(c["createCommentVNode"])("",!0),e.siteAccessToChange?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createElementBlock"])("p",{key:1,innerHTML:e.$sanitize(e.changePermToSiteConfirmMultipleText)},null,8,Se))]),Object(c["createElementVNode"])("div",ke,[Object(c["createElementVNode"])("a",{href:"",class:"modal-action modal-close btn",onClick:t[16]||(t[16]=Object(c["withModifiers"])((function(t){return e.changeUserRole()}),["prevent"]))},Object(c["toDisplayString"])(e.translate("General_Yes")),1),Object(c["createElementVNode"])("a",{href:"",class:"modal-action modal-close modal-no",onClick:t[17]||(t[17]=Object(c["withModifiers"])((function(t){e.siteAccessToChange.role=e.previousRole,e.siteAccessToChange=null,e.roleToChangeTo=null}),["prevent"]))},Object(c["toDisplayString"])(e.translate("General_No")),1)])],512),Object(c["createElementVNode"])("div",Ve,[Object(c["createElementVNode"])("div",Me,[Object(c["createElementVNode"])("h3",{innerHTML:e.$sanitize(e.changePermToAllSitesConfirmText)},null,8,Le),Object(c["createElementVNode"])("p",null,Object(c["toDisplayString"])(e.translate("UsersManager_ChangePermToAllSitesConfirm2")),1)]),Object(c["createElementVNode"])("div",we,[Object(c["createElementVNode"])("a",{href:"",class:"modal-action modal-close btn",onClick:t[18]||(t[18]=Object(c["withModifiers"])((function(t){return e.giveAccessToAllSites()}),["prevent"]))},Object(c["toDisplayString"])(e.translate("General_Yes")),1),Object(c["createElementVNode"])("a",{href:"",class:"modal-action modal-close modal-no",onClick:t[19]||(t[19]=function(e){return e.preventDefault()})},Object(c["toDisplayString"])(e.translate("General_No")),1)])],512)],2)}var Re=window,xe=Re.$,_e=Object(c["defineComponent"])({props:{userLogin:{type:String,required:!0},limit:{type:Number,default:10},accessLevels:{type:Array,required:!0},filterAccessLevels:{type:Array,required:!0}},components:{Notification:l["Notification"],Field:g["Field"],CapabilitiesEdit:S},directives:{DropdownMenu:l["DropdownMenu"],ContentTable:l["ContentTable"]},data:function(){return{siteAccess:[],offset:0,totalEntries:null,accessLevelFilter:"",siteNameFilter:"",isLoadingAccess:!1,allWebsitesAccssLevelSet:"view",isAllCheckboxSelected:!1,selectedRows:{},isBulkActionsDisabled:!0,areAllResultsSelected:!1,previousRole:null,hasAccessToAtLeastOneSite:!0,isRoleHelpToggled:!1,isCapabilitiesHelpToggled:!1,isGivingAccessToAllSites:!1,roleToChangeTo:null,siteAccessToChange:null}},emits:["fetched","accessChanged"],created:function(){var e=this;this.onChangeSiteFilter=Object(l["debounce"])(this.onChangeSiteFilter,300),Object(c["watch"])((function(){return e.allPropsWatch}),(function(){e.limit&&e.fetchAccess()})),this.fetchAccess()},watch:{accessLevelFilter:function(){this.offset=0,this.fetchAccess()}},methods:{onAllCheckboxChange:function(e){var t=this;this.isAllCheckboxSelected=e.target.checked,this.isAllCheckboxSelected?(this.siteAccess.forEach((function(e,i){t.selectedRows[i]=!0})),this.isBulkActionsDisabled=!1):this.clearSelection()},clearSelection:function(){this.selectedRows={},this.areAllResultsSelected=!1,this.isBulkActionsDisabled=!0,this.isAllCheckboxSelected=!1,this.siteAccessToChange=null},onRowSelected:function(){var e=this;setTimeout((function(){var t=e.selectedRowsCount;e.isBulkActionsDisabled=0===t,e.isAllCheckboxSelected=t===e.siteAccess.length}))},fetchAccess:function(){var e=this;return this.isLoadingAccess=!0,l["AjaxHelper"].fetch({method:"UsersManager.getSitesAccessForUser",limit:this.limit,offset:this.offset,filter_search:this.siteNameFilter,filter_access:this.accessLevelFilter,userLogin:this.userLogin},{returnResponseObject:!0}).then((function(t){var i=t.getRequestHandle();e.isLoadingAccess=!1,e.siteAccess=i.responseJSON,e.totalEntries=parseInt(i.getResponseHeader("x-matomo-total-results"),10)||0,e.hasAccessToAtLeastOneSite=!!i.getResponseHeader("x-matomo-has-some"),e.$emit("fetched",{hasAccess:e.hasAccessToAtLeastOneSite}),e.clearSelection()})).catch((function(){e.isLoadingAccess=!1,e.clearSelection()}))},gotoPreviousPage:function(){this.offset=Math.max(0,this.offset-this.limit),this.fetchAccess()},gotoNextPage:function(){var e=this.offset+this.limit;e>=(this.totalEntries||0)||(this.offset=e,this.fetchAccess())},showRemoveAccessConfirm:function(){xe(this.$refs.deleteAccessConfirmModal).modal({dismissible:!1}).modal("open")},changeUserRole:function(){var e=this,t=function(){var t=[];return Object.keys(e.selectedRows).forEach((function(i){e.selectedRows[i]&&e.siteAccess[i]&&t.push(e.siteAccess[i].idsite)})),t},i=function(){return l["AjaxHelper"].fetch({method:"UsersManager.getSitesAccessForUser",filter_search:e.siteNameFilter,filter_access:e.accessLevelFilter,userLogin:e.userLogin,filter_limit:"-1"}).then((function(e){return e.map((function(e){return e.idsite}))}))};return this.isLoadingAccess=!0,Promise.resolve().then((function(){return e.siteAccessToChange?[e.siteAccessToChange.idsite]:e.areAllResultsSelected?i():t()})).then((function(t){return l["AjaxHelper"].post({method:"UsersManager.setUserAccess"},{userLogin:e.userLogin,access:e.roleToChangeTo,idSites:t})})).catch((function(){})).then((function(){return e.$emit("accessChanged"),e.fetchAccess()}))},showChangeAccessConfirm:function(){xe(this.$refs.changeAccessConfirmModal).modal({dismissible:!1}).modal("open")},getRoleDisplay:function(e){var t=null;return this.filteredAccessLevels.forEach((function(i){i.key===e&&(t=i.value)})),t},giveAccessToAllSites:function(){var e=this;this.isGivingAccessToAllSites=!0,l["AjaxHelper"].fetch({method:"SitesManager.getSitesWithAdminAccess"}).then((function(t){var i=t.map((function(e){return e.idsite}));return l["AjaxHelper"].post({method:"UsersManager.setUserAccess"},{userLogin:e.userLogin,access:e.allWebsitesAccssLevelSet,idSites:i})})).then((function(){return e.fetchAccess()})).finally((function(){e.isGivingAccessToAllSites=!1}))},showChangeAccessAllSitesModal:function(){xe(this.$refs.confirmGiveAccessAllSitesModal).modal({dismissible:!1}).modal("open")},onChangeSiteFilter:function(e){var t=this;setTimeout((function(){t.siteNameFilter=e.target.value,t.offset=0,t.fetchAccess()}))},onRoleChange:function(e,t){this.previousRole=e.role,this.roleToChangeTo=t,this.siteAccessToChange=e,this.showChangeAccessConfirm()}},computed:{rolesHelpText:function(){return Object(l["translate"])("UsersManager_RolesHelp",'<a href="https://matomo.org/faq/general/faq_70/" target="_blank" rel="noreferrer noopener">',"</a>",'<a href="https://matomo.org/faq/general/faq_69/" target="_blank" rel="noreferrer noopener">',"</a>")},theDisplayedWebsitesAreSelectedText:function(){return Object(l["translate"])("UsersManager_TheDisplayedWebsitesAreSelected","<strong>".concat(this.siteAccess.length,"</strong>"))},clickToSelectAllText:function(){return Object(l["translate"])("UsersManager_ClickToSelectAll","<strong>".concat(this.totalEntries,"</strong>"))},allWebsitesAreSelectedText:function(){return Object(l["translate"])("UsersManager_AllWebsitesAreSelected","<strong>".concat(this.totalEntries,"</strong>"))},clickToSelectDisplayedWebsitesText:function(){return Object(l["translate"])("UsersManager_ClickToSelectDisplayedWebsites","<strong>".concat(this.siteAccess.length,"</strong>"))},deletePermConfirmSingleText:function(){return Object(l["translate"])("UsersManager_DeletePermConfirmSingle","<strong>".concat(this.userLogin,"</strong>"),"<strong>".concat(this.siteAccessToChangeName,"</strong>"))},deletePermConfirmMultipleText:function(){return Object(l["translate"])("UsersManager_DeletePermConfirmMultiple","<strong>".concat(this.userLogin,"</strong>"),"<strong>".concat(this.affectedSitesCount,"</strong>"))},changePermToSiteConfirmSingleText:function(){return Object(l["translate"])("UsersManager_ChangePermToSiteConfirmSingle","<strong>".concat(this.userLogin,"</strong>"),"<strong>".concat(this.siteAccessToChangeName,"</strong>"),"<strong>".concat(this.getRoleDisplay(this.roleToChangeTo),"</strong>"))},changePermToSiteConfirmMultipleText:function(){return Object(l["translate"])("UsersManager_ChangePermToSiteConfirmMultiple","<strong>".concat(this.userLogin,"</strong>"),"<strong>".concat(this.affectedSitesCount,"</strong>"),"<strong>".concat(this.getRoleDisplay(this.roleToChangeTo),"</strong>"))},changePermToAllSitesConfirmText:function(){return Object(l["translate"])("UsersManager_ChangePermToAllSitesConfirm","<strong>".concat(this.userLogin,"</strong>"),"<strong>".concat(this.getRoleDisplay(this.allWebsitesAccssLevelSet),"</strong>"))},paginationLowerBound:function(){return this.offset+1},paginationUpperBound:function(){return this.totalEntries?Math.min(this.offset+this.limit,this.totalEntries):"?"},filteredAccessLevels:function(){return this.accessLevels.filter((function(e){return"superuser"!==e.key}))},filteredSelectAccessLevels:function(){return this.filterAccessLevels.filter((function(e){return"superuser"!==e.key}))},selectedRowsCount:function(){var e=0;return Object.values(this.selectedRows).forEach((function(t){t&&(e+=1)})),e},affectedSitesCount:function(){return this.areAllResultsSelected?this.totalEntries:this.selectedRowsCount},allPropsWatch:function(){return this.userLogin,this.limit,this.accessLevels,this.filterAccessLevels,Date.now()},siteAccessToChangeName:function(){return this.siteAccessToChange?l["Matomo"].helper.htmlEntities(this.siteAccessToChange.site_name):""}}});_e.render=Be;var Ue=_e;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(l["createAngularJsAdapter"])({component:Ue,scope:{userLogin:{angularJsBind:"<"},limit:{angularJsBind:"<"},onUserHasAccessDetected:{angularJsBind:"&",vue:"accessChanged"},onAccessChange:{angularJsBind:"&",vue:"fetched"},accessLevels:{angularJsBind:"<"},filterAccessLevels:{angularJsBind:"<"}},directiveName:"piwikUserPermissionsEdit",restrict:"E"})}})}));
//# sourceMappingURL=UsersManager.umd.min.js.map