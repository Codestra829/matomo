<div
    piwik-content-block
    content-title="{{ $ctrl.getFormTitle() }}"
    class="userEditForm"
    ng-class="{ loading: $ctrl.isSavingUserInfo }"
>
    <div class="row" piwik-form>
        <div class="col m2 entityList">
            <ul class="listCircle">
                <li ng-class="{active: $ctrl.activeTab === 'basic'}" class="menuBasicInfo">
                    <a href="" ng-click="$ctrl.activeTab = 'basic'">Basic Information</a>
                </li>

                <li ng-class="{active: $ctrl.activeTab === 'permissions'}" class="menuPermissions" ng-if="!$ctrl.isAdd">
                    <a href="" ng-click="$ctrl.activeTab = 'permissions'">
                        Permissions
                    </a>
                    <span class="icon-warning" ng-if="!$ctrl.userHasAccess && !$ctrl.user.superuser_access"></span>
                </li>

                <li ng-class="{active: $ctrl.activeTab === 'superuser'}" class="menuSuperuser" ng-if="$ctrl.currentUserRole == 'superuser' && !$ctrl.isAdd">
                    <a href="" ng-click="$ctrl.activeTab = 'superuser'">Superuser Access</a>
                </li>
            </ul>

            <div class="save-button-spacer hide-on-small-only">
            </div>

            <div class='entityCancel' ng-click="$ctrl.onDoneEditing({ isUserModified: $ctrl.isUserModified })">
                <a href="" class="entityCancelLink">{{:: 'Mobile_NavigationBack'|translate }}</a>
            </div>
        </div>

        <div class="visibleTab col m10">
            <div ng-if="$ctrl.activeTab === 'basic'" class="basic-info-tab">
                <div
                        piwik-field
                        uicontrol="text"
                        name="user_login"
                        ng-model="$ctrl.user.login"
                        title="Username"
                        maxlength="100"
                        disabled="$ctrl.isSavingUserInfo || !$ctrl.isAdd"
                >
                </div>

                <div
                        piwik-field
                        uicontrol="password"
                        name="user_password"
                        ng-model="$ctrl.user.password"
                        title="Password"
                        ng-change="$ctrl.isPasswordChanged = true;"
                        disabled="$ctrl.isSavingUserInfo"
                >
                </div>

                <div
                        piwik-field
                        uicontrol="text"
                        name="user_email"
                        ng-model="$ctrl.user.email"
                        title="Email"
                        maxlength="100"
                        disabled="$ctrl.isSavingUserInfo"
                >
                </div>

                <div
                        piwik-field
                        uicontrol="site"
                        name="user_site"
                        ng-model="$ctrl.firstSiteAccess"
                        title="First website permission"
                        disabled="$ctrl.isSavingUserInfo"
                        ng-if="$ctrl.isAdd"
                        ui-control-attributes="{ onlySitesWithAdminAccess: true }"
                        inline-help="It is required to give a new user access to at least one website upon creation. If no access is given, the user will see an error when logging in. You can give more access after the user is created in the 'Permissions' tab that will appear on the left."
                >
                </div>

                <div piwik-save-button
                     saving="$ctrl.isSavingUserInfo"
                     onconfirm="$ctrl.saveUserInfo()"
                     ng-value="$ctrl.getSaveButtonLabel()"
                     disabled="$ctrl.isAdd && !$ctrl.firstSiteAccess"
                ></div>
            </div>

            <div ng-if="$ctrl.activeTab === 'permissions' && !$ctrl.isAdd" class="user-permissions">
                <piwik-user-permissions-edit
                    user-login="$ctrl.user.login"
                    ng-if="!$ctrl.user.superuser_access"
                    on-user-has-access-detected="$ctrl.userHasAccess = hasAccess"
                    on-access-change="$ctrl.isUserModified = true"
                    access-levels="$ctrl.accessLevels"
                    filter-access-levels="$ctrl.filterAccessLevels"
                >
                </piwik-user-permissions-edit>
                <p ng-if="$ctrl.user.superuser_access">
                    Super users have admin access to all websites, so there's no need to manage their permissions per website.
                </p>
            </div>

            <div ng-if="$ctrl.activeTab === 'superuser' && $ctrl.currentUserRole == 'superuser' && !$ctrl.isAdd" class="superuser-access">
                <p>Super users have the highest permissions. They can perform all administrative tasks such as adding new websites to monitor, adding users, changing user permissions, activating and deactivating plugins and even installing new plugins from the Marketplace.
                    You can grant Super User access to other users of Divezone here.</p>

                <p><strong>Please use this feature carefully.</strong></p>

                <div
                    piwik-field
                    uicontrol="checkbox"
                    name="superuser_access"
                    ng-model="$ctrl.user.superuser_access"
                    title="Has Superuser Access"
                    ng-click="$ctrl.confirmSuperUserChange()"
                    disabled="$ctrl.isSavingUserInfo"
                >
                </div>

                <div class="superuser-confirm-modal modal">
                    <div class="modal-content">
                        <h2>Are you sure?</h2>
                        <p ng-if="!$ctrl.user.superuser_access">
                            Removing superuser access will leave the user with no permissions (you will have to add them afterwards). Do you wish to continue?
                        </p>
                        <p ng-if="$ctrl.user.superuser_access">
                            Giving a user superuser access will allow the user to have full control over Matomo and should be done sparingly. Do you wish to continue?
                        </p>
                    </div>
                    <div class="modal-footer">
                        <a href="" class="modal-action modal-close btn" ng-click="$ctrl.toggleSuperuserAccess()">Yes</a>
                        <a href="" class="modal-action modal-close modal-no" ng-click="$ctrl.user.superuser_access = !$ctrl.user.superuser_access">No</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
