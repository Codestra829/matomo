(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["ScheduledReports"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["ScheduledReports"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,r){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="plugins/ScheduledReports/vue/dist/",r(r.s="fae3")}({"19dc":function(t,r){t.exports=e},"52e8":function(e,t){},"8bbf":function(e,r){e.exports=t},a5a2:function(e,t){e.exports=r},fae3:function(e,t,r){"use strict";if(r.r(t),r.d(t,"ManageScheduledReport",(function(){return nt})),"undefined"!==typeof window){var o=window.document.currentScript,n=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(r.p=n[1])}var l=r("8bbf"),i={class:"emailReports",ref:"root"},c={ref:"reportSentSuccess"},a={ref:"reportUpdatedSuccess"},p=Object(l["createElementVNode"])("div",{id:"ajaxError",style:{display:"none"}},null,-1),d={id:"ajaxLoadingDiv",style:{display:"none"}},s={class:"loadingPiwik"},u=["alt"],m={class:"loadingSegment"},b=Object(l["createElementVNode"])("a",{id:"bottom"},null,-1);function O(e,t,r,o,n,O){var y=Object(l["resolveComponent"])("ListReports"),j=Object(l["resolveComponent"])("AddReport");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",i,[Object(l["createElementVNode"])("div",c,null,512),Object(l["createElementVNode"])("div",a,null,512),Object(l["createElementVNode"])("div",null,[p,Object(l["createElementVNode"])("div",d,[Object(l["createElementVNode"])("div",s,[Object(l["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif",alt:e.translate("General_LoadingData")},null,8,u),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("General_LoadingData")),1)]),Object(l["createElementVNode"])("div",m,Object(l["toDisplayString"])(e.translate("SegmentEditor_LoadingSegmentedDataMayTakeSomeTime")),1)]),Object(l["withDirectives"])(Object(l["createVNode"])(y,{title:e.title,"user-login":e.userLogin,"login-module":e.loginModule,reports:e.reports,"site-name":e.siteName,"segment-editor-activated":e.segmentEditorActivated,"saved-segments-by-id":e.savedSegmentsById,periods:e.periods,recipient:e.recipient,"report-types":e.reportTypes,"download-output-type":e.downloadOutputType,language:e.language,"report-formats-by-report-type":e.reportFormatsByReportType,onCreate:t[0]||(t[0]=function(t){return e.createReport()}),onEdit:t[1]||(t[1]=function(t){return e.editReport(t)}),onDelete:t[2]||(t[2]=function(t){return e.deleteReport(t)}),onSendnow:t[3]||(t[3]=function(t){return e.sendReportNow(t)})},null,8,["title","user-login","login-module","reports","site-name","segment-editor-activated","saved-segments-by-id","periods","recipient","report-types","download-output-type","language","report-formats-by-report-type"]),[[l["vShow"],e.showReportsList]]),e.showReportForm?(Object(l["openBlock"])(),Object(l["createBlock"])(j,{key:0,report:e.report,"param-periods":e.paramPeriods,"report-type-options":e.reportTypeOptions,"report-formats-by-report-type-options":e.reportFormatsByReportTypeOptions,"report-formats":e.reportFormats,"display-formats":e.displayFormats,"reports-by-category-by-report-type":e.reportsByCategoryByReportType,"allow-multiple-reports-by-report-type":e.allowMultipleReportsByReportType,"reports-by-category":e.reportsByCategory,"count-websites":e.countWebsites,"site-name":e.siteName,"selected-reports":e.selectedReports,onToggleSelectedReport:e.selectedReports[e.$event.reportType][e.$event.uniqueId],onChange:t[4]||(t[4]=function(t){return e.onChangeProperty(t.prop,t.value)}),onSubmit:t[5]||(t[5]=function(t){return e.submitReport()})},{"report-parameters":Object(l["withCtx"])((function(){return[Object(l["renderSlot"])(e.$slots,"report-parameters")]})),_:3},8,["report","param-periods","report-type-options","report-formats-by-report-type-options","report-formats","display-formats","reports-by-category-by-report-type","allow-multiple-reports-by-report-type","reports-by-category","count-websites","site-name","selected-reports","onToggleSelectedReport"])):Object(l["createCommentVNode"])("",!0),b])],512)}var y=r("19dc"),j=r("a5a2"),h=Object(l["createElementVNode"])("div",{class:"clear"},null,-1),f={key:0},g=["innerHTML"],v={id:"emailScheduleInlineHelp",class:"inline-help-node"},S=Object(l["createElementVNode"])("br",null,null,-1),R={id:"emailReportPeriodInlineHelp",class:"inline-help-node"},N=Object(l["createElementVNode"])("br",null,null,-1),E=Object(l["createElementVNode"])("br",null,null,-1),V={key:0,id:"reportHourHelpText",class:"inline-help-node"},k=["textContent"],_={ref:"reportParameters"},B={class:"email"},w={class:"report_evolution_graph"},C={class:"row evolution-graph-period"},T={class:"col s12"},P={for:"report_evolution_period_for_each"},D=["checked"],x=["innerHTML"],F={class:"col s12"},q={for:"report_evolution_period_for_prev"},I=["checked"],M=["value"],L={class:"row"},H={class:"col s12"},A={class:"reportCategory"},G={class:"listReports"},U=["name","type","id","checked","onChange"],z={key:0,class:"entityInlineHelp"},W=Object(l["createElementVNode"])("br",null,null,-1),Z=["innerHTML"];function K(e,t,r,o,n,i){var c=Object(l["resolveComponent"])("Field"),a=Object(l["resolveComponent"])("SaveButton"),p=Object(l["resolveComponent"])("ContentBlock"),d=Object(l["resolveDirective"])("form");return Object(l["openBlock"])(),Object(l["createBlock"])(p,{class:"entityAddContainer","content-title":e.translate("ScheduledReports_CreateAndScheduleReport")},{default:Object(l["withCtx"])((function(){return[h,Object(l["withDirectives"])(Object(l["createElementVNode"])("form",{id:"addEditReport",onSubmit:t[13]||(t[13]=function(t){return e.$emit("submit")})},[Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"text",name:"website",title:e.translate("General_Website"),disabled:!0,value:e.siteName},null,8,["title","value"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"textarea",name:"report_description",title:e.translate("General_Description"),"model-value":e.report.description,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.$emit("change",{prop:"description",value:t})}),"inline-help":e.translate("ScheduledReports_DescriptionOnFirstPage")},null,8,["title","model-value","inline-help"])]),e.segmentEditorActivated?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",f,[Object(l["createVNode"])(c,{uicontrol:"select",name:"report_segment",title:e.translate("SegmentEditor_ChooseASegment"),"model-value":e.report.idsegment,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.$emit("change",{prop:"idsegment",value:t})}),options:e.savedSegmentsById},{"inline-help":Object(l["withCtx"])((function(){return[e.segmentEditorActivated?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:0,id:"reportSegmentInlineHelp",class:"inline-help-node",innerHTML:e.reportSegmentInlineHelp},null,8,g)):Object(l["createCommentVNode"])("",!0)]})),_:1},8,["title","model-value","options"])])):Object(l["createCommentVNode"])("",!0),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"select",name:"report_schedule","model-value":e.report.period,"onUpdate:modelValue":t[2]||(t[2]=function(t){e.$emit("change",{prop:"period",value:t}),e.$emit("change",{prop:"periodParam",value:"never"===e.report.period?null:e.report.period})}),title:e.translate("ScheduledReports_EmailSchedule"),options:e.periods},{"inline-help":Object(l["withCtx"])((function(){return[Object(l["createElementVNode"])("div",v,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("ScheduledReports_WeeklyScheduleHelp"))+" ",1),S,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_MonthlyScheduleHelp")),1)])]})),_:1},8,["model-value","title","options"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"select",name:"report_period","model-value":e.report.periodParam,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.$emit("change",{prop:"periodParam",value:t})}),options:e.paramPeriods,title:e.translate("ScheduledReports_ReportPeriod")},{"inline-help":Object(l["withCtx"])((function(){return[Object(l["createElementVNode"])("div",R,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportPeriodHelp"))+" ",1),N,E,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportPeriodHelp2")),1)])]})),_:1},8,["model-value","options","title"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"select",name:"report_hour","model-value":e.report.hour,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.$emit("change",{prop:"hour",value:t})}),title:e.translate("ScheduledReports_ReportHour","X"),options:e.reportHours},{"inline-help":Object(l["withCtx"])((function(){return[0!==e.timezoneOffset&&"0"!==e.timezoneOffset?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",V,[Object(l["createElementVNode"])("span",{textContent:Object(l["toDisplayString"])(e.reportHourUtc)},null,8,k)])):Object(l["createCommentVNode"])("",!0)]})),_:1},8,["model-value","title","options"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"select",name:"report_type",disabled:1===e.reportTypes.length,"model-value":e.report.type,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.$emit("change",{prop:"type",value:t})}),title:e.translate("ScheduledReports_ReportType"),options:e.reportTypeOptions},null,8,["disabled","model-value","title","options"])]),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.reportFormatsByReportTypeOptions,(function(t,r){return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:t},[Object(l["withDirectives"])(Object(l["createVNode"])(c,{uicontrol:"select",name:"report_format",title:e.translate("ScheduledReports_ReportFormat"),class:Object(l["normalizeClass"])(t),"model-value":e.report["format".concat(t)],"onUpdate:modelValue":function(r){return e.$emit("change",{prop:"format".concat(t),value:r})},options:r},null,8,["title","class","model-value","onUpdate:modelValue","options"]),[[l["vShow"],e.report.type===t]])])})),128)),Object(l["createElementVNode"])("div",_,[Object(l["renderSlot"])(e.$slots,"report-parameters")],512),Object(l["withDirectives"])(Object(l["createElementVNode"])("div",null,[Object(l["createElementVNode"])("div",B,[Object(l["createVNode"])(c,{uicontrol:"select",name:"display_format","model-value":e.report.displayFormat,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.$emit("change",{prop:"displayFormat",value:t})}),options:e.displayFormats,introduction:e.translate("ScheduledReports_AggregateReportsFormat")},null,8,["model-value","options","introduction"])]),Object(l["createElementVNode"])("div",w,[Object(l["withDirectives"])(Object(l["createVNode"])(c,{uicontrol:"checkbox",name:"report_evolution_graph",title:e.translate("ScheduledReports_EvolutionGraph",5),"model-value":e.report.evolutionGraph,"onUpdate:modelValue":t[7]||(t[7]=function(t){return e.$emit("change",{prop:"evolutionGraph",value:t})})},null,8,["title","model-value"]),[[l["vShow"],e.report.displayFormat in[2,"2",3,"3"]]])]),Object(l["withDirectives"])(Object(l["createElementVNode"])("div",C,[Object(l["createElementVNode"])("div",T,[Object(l["createElementVNode"])("label",P,[Object(l["createElementVNode"])("input",{id:"report_evolution_period_for_each",name:"report_evolution_period_for",type:"radio",value:"each",checked:"each"===e.report.evolutionPeriodFor,onChange:t[8]||(t[8]=function(t){return e.$emit("change",{prop:"evolutionPeriodFor",value:t})})},null,40,D),Object(l["createElementVNode"])("span",{innerHTML:e.$sanitize(e.evolutionGraphsShowForEachInPeriod)},null,8,x)])]),Object(l["createElementVNode"])("div",F,[Object(l["createElementVNode"])("label",q,[Object(l["createElementVNode"])("input",{id:"report_evolution_period_for_prev",name:"report_evolution_period_for",type:"radio",value:"prev",checked:"prev"===e.report.evolutionPeriodFor,onChange:t[9]||(t[9]=function(t){return e.$emit("change",{prop:"evolutionPeriodFor",value:t})})},null,40,I),Object(l["createElementVNode"])("span",null,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("ScheduledReports_EvolutionGraphsShowForPreviousN",e.frequencyPeriodPlural))+": ",1),Object(l["createElementVNode"])("input",{type:"number",name:"report_evolution_period_n",value:e.report.evolutionPeriodN,onKeydown:t[10]||(t[10]=function(t){return e.onEvolutionPeriodN(t)}),onChange:t[11]||(t[11]=function(t){return e.onEvolutionPeriodN(t)})},null,40,M)])])])],512),[[l["vShow"],e.report.displayFormat in[1,"1",2,"2",3,"3"]]])],512),[[l["vShow"],"email"===e.report.type&&"csv"!==e.report.formatemail&&"tsv"!==e.report.formatemail]]),Object(l["createElementVNode"])("div",L,[Object(l["createElementVNode"])("h3",H,Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportsIncluded")),1)]),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.reportsByCategoryByReportTypeInColumns,(function(t,r){return Object(l["withDirectives"])((Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{name:"reportsList",class:Object(l["normalizeClass"])("row ".concat(t)),key:t},[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(r,(function(r,o){return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{class:"col s12 m6",key:o},[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(r,(function(r,o){return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:r},[Object(l["createElementVNode"])("h3",A,Object(l["toDisplayString"])(r),1),Object(l["createElementVNode"])("ul",G,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(o,(function(r){var o;return Object(l["openBlock"])(),Object(l["createElementBlock"])("li",{key:r.uniqueId},[Object(l["createElementVNode"])("label",null,[Object(l["createElementVNode"])("input",{name:"".concat(t,"Reports"),type:e.allowMultipleReportsByReportType[t]?"checkbox":"radio",id:"".concat(t).concat(r.uniqueId),checked:null===(o=e.selectedReports[t])||void 0===o?void 0:o[r.uniqueId],onChange:function(o){return e.$emit("toggleSelectedReport",{reportType:t,uniqueId:r.uniqueId})}},null,40,U),Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(r.name),1),"MultiSites_getAll"===r.uniqueId?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",z,Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportIncludeNWebsites",e.countWebsites)),1)):Object(l["createCommentVNode"])("",!0)])])})),128))]),W])})),128))])})),128))],2)),[[l["vShow"],e.report.type===t]])})),128)),Object(l["createVNode"])(a,{value:e.saveButtonTitle,onConfirm:t[12]||(t[12]=function(t){return e.$emit("submit")})},null,8,["value"]),Object(l["createElementVNode"])("div",{class:"entityCancel",innerHTML:e.entityCancelText},null,8,Z)],544),[[d]])]})),_:3},8,["content-title"])}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function X(e,t){return"".concat((24+parseFloat(e)+t)%24)}function J(e,t){return re(e)||te(e,t)||Y(e,t)||Q()}function Q(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Y(e,t){if(e){if("string"===typeof e)return ee(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ee(e,t):void 0}}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function te(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var o,n,l=[],i=!0,c=!1;try{for(r=r.call(e);!(i=(o=r.next()).done);i=!0)if(l.push(o.value),t&&l.length===t)break}catch(a){c=!0,n=a}finally{try{i||null==r["return"]||r["return"]()}finally{if(c)throw n}}return l}}function re(e){if(Array.isArray(e))return e}var oe=window,ne=oe.ReportPlugin,le=Object(l["defineComponent"])({props:{report:{type:Object,required:!0},selectedReports:Object,paramPeriods:{type:Object,required:!0},reportTypeOptions:{type:Object,required:!0},reportFormatsByReportTypeOptions:{type:Object,required:!0},displayFormats:{type:Object,required:!0},reportsByCategoryByReportType:{type:Object,required:!0},allowMultipleReportsByReportType:{type:Object,required:!0},countWebsites:{type:Number,required:!0},siteName:{type:String,required:!0}},emits:["submit","change"],components:{ContentBlock:y["ContentBlock"],Field:j["Field"],SaveButton:j["SaveButton"]},directives:{Form:j["Form"]},created:function(){this.onEvolutionPeriodN=Object(y["debounce"])(this.onEvolutionPeriodN,50)},methods:{onEvolutionPeriodN:function(e){this.$emit("change","evolutionPeriodN",e)}},mounted:function(){y["Matomo"].helper.compileAngularComponents($(this.$refs.reportParameters))},computed:{reportsByCategoryByReportTypeInColumns:function(){var e=this.reportsByCategoryByReportType,t=Object.entries(e).map((function(e){var t=J(e,2),r=t[0],o=t[1],n=Math.floor((Object.keys(o).length+1)/2),l={},i={},c=l;return Object.entries(o).forEach((function(e){var t=J(e,2),r=t[0],o=t[1];c[r]=o,Object.keys(c).length>n&&(c=i)})),[r,[l,i]]}));return Object.fromEntries(t)},entityCancelText:function(){return Object(y["translate"])("General_OrCancel",'<a class="entityCancelLink">',"</a>")},frequencyPeriodSingle:function(){if(!this.report||!this.report.period)return"";var e=ne.periodTranslations[this.report.period];return e||(e=ne.periodTranslations.day),e.single},frequencyPeriodPlural:function(){if(!this.report||!this.report.period)return"";var e=ne.periodTranslations[this.report.period];return e||(e=ne.periodTranslations.day),e.plural},evolutionGraphsShowForEachInPeriod:function(){return Object(y["translate"])("ScheduledReports_EvolutionGraphsShowForEachInPeriod","<strong>","</strong>",this.frequencyPeriodSingle)},reportSegmentInlineHelp:function(){return Object(y["translate"])("ScheduledReports_Segment_Help",'<a href="./" rel="noreferrer noopener" target="_blank">',"</a>",Object(y["translate"])("SegmentEditor_DefaultAllVisits"),Object(y["translate"])("SegmentEditor_AddNewSegment"))},timezoneOffset:function(){return y["Matomo"].timezoneOffset},timeZoneDifferenceInHours:function(){return y["Matomo"].timezoneOffset/3600},reportHours:function(){for(var e=[],t=0;t<24;t+=1)2*this.timeZoneDifferenceInHours%2!==0?e.push({key:"".concat(t,".5"),value:"".concat(t,":30")}):e.push({key:"".concat(t),value:"".concat(t)});return e},reportHourUtc:function(){var e=X(this.report.hour,-this.timeZoneDifferenceInHours);return Object(y["translate"])("ScheduledReports_ReportHourWithUTC",[e])},saveButtonTitle:function(){var e=this.report.idreport>0;return e?ne.updateReportString:ne.createReportString}}});le.render=K;var ie=le,ce={class:"first"},ae={key:0},pe={colspan:"7"},de=Object(l["createElementVNode"])("br",null,null,-1),se=Object(l["createElementVNode"])("br",null,null,-1),ue=Object(l["createTextVNode"])("› "),me=["href"],be=Object(l["createElementVNode"])("br",null,null,-1),Oe=Object(l["createElementVNode"])("br",null,null,-1),ye={key:1},je={colspan:"7"},he=Object(l["createElementVNode"])("br",null,null,-1),fe=Object(l["createElementVNode"])("br",null,null,-1),ge=Object(l["createElementVNode"])("br",null,null,-1),ve={class:"first"},Se={key:0,class:"entityInlineHelp",style:{"font-size":"9pt"}},Re={key:0},Ne={key:1},Ee={key:0},Ve={key:0},ke=Object(l["createElementVNode"])("br",null,null,-1),_e=["onClick"],Be=["src"],we=["id","action"],Ce=["value"],Te=Object(l["createElementVNode"])("input",{type:"hidden",name:"force_api_session",value:"1"},null,-1),Pe=["onClick","id"],De=["src"],xe={style:{"text-align":"center","padding-top":"2px"}},Fe=["onClick","title"],qe=Object(l["createElementVNode"])("span",{class:"icon-edit"},null,-1),Ie=[qe],Me={style:{"text-align":"center","padding-top":"2px"}},Le=["onClick","title"],He=Object(l["createElementVNode"])("span",{class:"icon-delete"},null,-1),Ae=[He],$e={class:"tableActionBar"},Ge=Object(l["createElementVNode"])("span",{class:"icon-add"},null,-1);function Ue(e,t,r,o,n,i){var c=Object(l["resolveComponent"])("ContentBlock"),a=Object(l["resolveDirective"])("content-table");return Object(l["openBlock"])(),Object(l["createBlock"])(c,{id:"entityEditContainer",class:"entityTableContainer","help-url":"https://matomo.org/docs/email-reports/",feature:!0,"content-title":e.title},{default:Object(l["withCtx"])((function(){var r;return[Object(l["withDirectives"])(Object(l["createElementVNode"])("table",null,[Object(l["createElementVNode"])("thead",null,[Object(l["createElementVNode"])("tr",null,[Object(l["createElementVNode"])("th",ce,Object(l["toDisplayString"])(e.translate("General_Description")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("ScheduledReports_EmailSchedule")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportFormat")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("ScheduledReports_SendReportTo")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Download")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Edit")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Delete")),1)])]),"anonymous"===e.userLogin?(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",ae,[Object(l["createElementVNode"])("td",pe,[de,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_MustBeLoggedIn"))+" ",1),se,ue,Object(l["createElementVNode"])("a",{href:"index.php?module=".concat(e.loginModule)},Object(l["toDisplayString"])(e.translate("Login_LogIn")),9,me),be,Oe])])):null!==(r=e.reports)&&void 0!==r&&r.length?Object(l["createCommentVNode"])("",!0):(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",ye,[Object(l["createElementVNode"])("td",je,[he,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_ThereIsNoReportToManage",e.siteName))+". ",1),fe,ge])])),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.reports,(function(t){return Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",{key:t.idreport},[Object(l["createElementVNode"])("td",ve,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(t.description)+" ",1),e.segmentEditorActivated&&t.idsegment?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",Se,[e.savedSegmentsById[t.idsegment]?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",Re,Object(l["toDisplayString"])(e.savedSegmentsById.report.idsegment),1)):(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",Ne,Object(l["toDisplayString"])(e.translate("ScheduledReports_SegmentDeleted")),1))])):Object(l["createCommentVNode"])("",!0)]),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(e.periods.report.period),1),Object(l["createElementVNode"])("td",null,[t.format?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",Ee,Object(l["toDisplayString"])(t.format.toUpperCase()),1)):Object(l["createCommentVNode"])("",!0)]),Object(l["createElementVNode"])("td",null,[0===t.recipients.length?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",Ve,Object(l["toDisplayString"])(e.translate("ScheduledReports_NoRecipients")),1)):Object(l["createCommentVNode"])("",!0),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t.recipients,(function(e,t){return Object(l["openBlock"])(),Object(l["createElementBlock"])("span",{key:t},[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e)+" ",1),ke])})),128)),Object(l["createElementVNode"])("a",{href:"#",name:"linkSendNow",class:"link_but withIcon",style:{"margin-top":"3px"},onClick:Object(l["withModifiers"])((function(r){return e.$emit("sendnow",t.idreport)}),["prevent"])},[Object(l["createElementVNode"])("img",{border:"0",src:e.reportTypes.report.type},null,8,Be),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_SendReportNow")),1)],8,_e)]),Object(l["createElementVNode"])("td",null,[Object(l["createElementVNode"])("form",{method:"POST",target:"_blank",id:"downloadReportForm_".concat(t.idreport),action:e.linkTo({module:"API",segment:null,method:"ScheduledReports.generateReport",idReport:t.idreport,outputType:e.downloadOutputType,language:e.language,format:t.format in["html","csv","tsv"]&&t.format})},[Object(l["createElementVNode"])("input",{type:"hidden",name:"token_auth",value:e.token_auth},null,8,Ce),Te],8,we),Object(l["createElementVNode"])("a",{href:"",rel:"noreferrer noopener",name:"linkDownloadReport",class:"link_but withIcon",onClick:Object(l["withModifiers"])((function(r){return e.displayReport(t.idreport)}),["prevent"]),id:t.idreport},[Object(l["createElementVNode"])("img",{border:"0",width:"16px",height:"16px",src:e.reportFormatsByReportType[t.type][t.format]},null,8,De),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("General_Download")),1)],8,Pe)]),Object(l["createElementVNode"])("td",xe,[Object(l["createElementVNode"])("button",{class:"table-action",onClick:function(r){return e.$emit("edit",parseInt(t.idreport,10))},title:e.translate("General_Edit")},Ie,8,Fe)]),Object(l["createElementVNode"])("td",Me,[Object(l["createElementVNode"])("button",{class:"table-action",onClick:function(r){return e.$emit("delete",t.idreport)},title:e.translate("General_Delete")},Ae,8,Le)])])})),128))],512),[[a]]),Object(l["createElementVNode"])("div",$e,["anonymous"!==e.userLogin?(Object(l["openBlock"])(),Object(l["createElementBlock"])("button",{key:0,id:"add-report",onClick:t[0]||(t[0]=function(t){return e.$emit("create")})},[Ge,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_CreateAndScheduleReport")),1)])):Object(l["createCommentVNode"])("",!0)])]})),_:1},8,["content-title"])}var ze=Object(l["defineComponent"])({props:{title:{type:String,required:!0},userLogin:{type:String,required:!0},loginModule:{type:String,required:!0},reports:{type:Array,required:!0},siteName:{type:String,required:!0},segmentEditorActivated:Boolean,savedSegmentsById:Object,periods:{type:Object,required:!0},downloadOutputType:{type:String,required:!0},language:{type:String,required:!0},reportFormatsByReportType:{type:Object,required:!0}},components:{ContentBlock:y["ContentBlock"]},directives:{ContentTable:y["ContentTable"]},emits:["create","edit","delete","sendnow"],methods:{linkTo:function(e){return"?".concat(y["MatomoUrl"].stringify(e))},displayReport:function(e){$("#downloadReportForm_".concat(e)).submit()}},computed:{token_auth:function(){return y["Matomo"].token_auth}}});ze.render=Ue;var We=ze;function Ze(){y["Matomo"].helper.lazyScrollTo(".emailReports",200)}function Ke(e,t){var r;null!==(r=window.updateReportParametersFunctions)&&void 0!==r&&r[e]&&window.updateReportParametersFunctions[e](t)}function Xe(e,t){var r;null!==(r=window.resetReportParametersFunctions)&&void 0!==r&&r[e]&&window.resetReportParametersFunctions[e](t)}var Je=window,Qe=Je.$,Ye=Je.ReportPlugin,et=y["Matomo"].timezoneOffset/3600,tt=Object(l["defineComponent"])({props:{title:{type:String,required:!0},userLogin:{type:String,required:!0},loginModule:{type:String,required:!0},reports:{type:Array,required:!0},siteName:{type:String,required:!0},segmentEditorActivated:Boolean,savedSegmentsById:Object,periods:{type:Object,required:!0},downloadOutputType:{type:String,required:!0},language:{type:String,required:!0},reportFormatsByReportType:{type:Object,required:!0},paramPeriods:{type:Object,required:!0},reportTypeOptions:{type:Object,required:!0},reportFormatsByReportTypeOptions:{type:Object,required:!0},displayFormats:{type:Object,required:!0},reportsByCategoryByReportType:{type:Object,required:!0},allowMultipleReportsByReportType:{type:Object,required:!0},countWebsites:{type:Number,required:!0}},components:{AddReport:ie,ListReports:We},directives:{ContentTable:y["ContentTable"],Form:j["Form"]},mounted:function(){var e=this;Qe(this.$refs.root).on("click","a.entityCancelLink",(function(){e.showListOfReports()}))},data:function(){return{showReportsList:!0,report:{},selectedReports:{}}},methods:{sendReportNow:function(e){var t=this;Ze(),y["AjaxHelper"].post({method:"ScheduledReports.sendReport"},{idReport:e,force:!0}).then((function(){t.fadeInOutSuccessMessage(t.$refs.reportSentSuccess,Object(y["translate"])("ScheduledReports_ReportSent"))}))},formSetEditReport:function(e){var t=this,r={idreport:e,type:Ye.defaultReportType,format:Ye.defaultReportFormat,description:"",period:Ye.defaultPeriod,hour:Ye.defaultHour,reports:[],idsegment:"",evolutionPeriodFor:"prev",evolutionPeriodN:Ye.defaultEvolutionPeriodN,periodParam:Ye.defaultPeriod};e>0?(this.report=Ye.reportList[e],Ke(r.type,this.report)):Xe(r.type,this.report),r.hour=X(r.hour,et),this.selectedReports={},Object.keys(r.reports).forEach((function(e){t.selectedReports[r.type]=t.selectedReports[r.type]||{},t.selectedReports[r.type][e]=!0})),r["format".concat(r.type)]=r.format,r.idsegment||(r.idsegment=""),this.report=r,this.report.description=y["Matomo"].helper.htmlDecode(r.description)},fadeInOutSuccessMessage:function(e,t){y["NotificationsStore"].show({message:t,placeat:e,context:"success",noclear:!0,type:"toast",style:{display:"inline-block",marginTop:"10px"},id:"scheduledReportSuccess"}),y["Matomo"].helper.refreshAfter(2)},changedReportType:function(){Xe(this.report.type,this.report)},deleteReport:function(e){y["Matomo"].helper.modalConfirm("#confirm",{yes:function(){y["AjaxHelper"].post({method:"ScheduledReports.deleteReport"},{idReport:e},{redirectOnSuccess:{}})}})},showListOfReports:function(e){this.showReportsList=!0,y["Matomo"].helper.hideAjaxError(),("undefined"===typeof e||e)&&Ze()},createReport:function(){this.showReportsList=!1,this.formSetEditReport(0)},editReport:function(e){this.showReportsList=!1,this.formSetEditReport(e)},submitReport:function(){var e=this,t={idReport:this.report.idreport,description:this.report.description,idSegment:this.report.idsegment,reportType:this.report.type,reportFormat:this.report["format".concat(this.report.type)],periodParam:this.report.periodParam,evolutionPeriodFor:this.report.evolutionPeriodFor};"each"!==t.evolutionPeriodFor&&(t.evolutionPeriodN=this.report.evolutionPeriodN);var r=this.report.period,o=X(this.report.hour,-et),n=Object.keys(this.selectedReports[t.reportType]).filter((function(r){return e.selectedReports[t.reportType][r]}));n.length>0&&(t.reports=n),t.parameters=window.getReportParametersFunctions[this.report.type](this.report);var l=this.report.idreport>0;return y["AjaxHelper"].post({method:l?"ScheduledReports.updateReport":"ScheduledReports.addReport",period:r,hour:o},t,{redirectOnSuccess:!0}).then((function(){e.fadeInOutSuccessMessage(e.$refs.reportUpdatedSuccess,Object(y["translate"])("ScheduledReports_ReportUpdated"))})),!1},onChangeProperty:function(e,t){this.report[e]=t,"type"===e&&this.changedReportType()}},computed:{showReportForm:function(){return!this.showListOfReports}}}),rt=r("52e8"),ot=r.n(rt);tt.render=O,"function"===typeof ot.a&&ot()(tt);var nt=tt;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=ScheduledReports.umd.min.js.map