(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue")):"function"===typeof define&&define.amd?define(["CoreHome"],t):"object"===typeof exports?exports["JsTrackerInstallCheck"]=t(require("CoreHome"),require("vue")):e["JsTrackerInstallCheck"]=t(e["CoreHome"],e["Vue"])})("undefined"!==typeof self?self:this,(function(e,t){return function(e){var t={};function s(n){if(t[n])return t[n].exports;var c=t[n]={i:n,l:!1,exports:{}};return e[n].call(c.exports,c,c.exports,s),c.l=!0,c.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)s.d(n,c,function(t){return e[t]}.bind(null,c));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="plugins/JsTrackerInstallCheck/vue/dist/",s(s.s="fae3")}({"19dc":function(t,s){t.exports=e},"8bbf":function(e,s){e.exports=t},fae3:function(e,t,s){"use strict";if(s.r(t),s.d(t,"JsTrackerInstallCheck",(function(){return b})),"undefined"!==typeof window){var n=window.document.currentScript,c=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);c&&(s.p=c[1])}var r=s("8bbf"),i={class:"jsTrackerInstallCheck"},o={class:"system-success success-message"},a=Object(r["createElementVNode"])("span",{class:"icon-ok"},null,-1),l={class:"system-errors test-error"},u=Object(r["createElementVNode"])("span",{class:"icon-warning"},null,-1),d=Object(r["createTextVNode"])("Â  "),h=["innerHTML"];function f(e,t,s,n,c,f){var p=Object(r["resolveComponent"])("ActivityIndicator");return Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],null,[Object(r["createElementVNode"])("li",null,Object(r["toDisplayString"])(e.translate("JsTrackerInstallCheck_TestInstallationDescription")),1),Object(r["createElementVNode"])("div",i,[Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{class:"btn testInstallBtn",onClick:t[0]||(t[0]=function(){return e.initiateTrackerTest&&e.initiateTrackerTest.apply(e,arguments)})},Object(r["toDisplayString"])(e.translate("JsTrackerInstallCheck_TestInstallationBtnText")),513),[[r["vShow"],!e.isTesting&&!e.isTestSuccess]]),Object(r["createVNode"])(p,{loading:e.isTesting,loadingMessage:e.translate("General_Testing")},null,8,["loading","loadingMessage"]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",o,[a,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("JsTrackerInstallCheck_JsTrackingCodeInstallCheckSuccessMessage")),1)],512),[[r["vShow"],e.isTestSuccess]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",l,[u,d,Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.getTestFailureMessage)},null,8,h)],512),[[r["vShow"],e.isTestComplete&&!e.isTestSuccess]])])],64)}var p=s("19dc"),T=10,k=1e3,m=Object(r["defineComponent"])({components:{ActivityIndicator:p["ActivityIndicator"]},data:function(){return{checkNonce:"",isTesting:!1,isTestComplete:!1,isTestSuccess:!1,testTimeoutCount:0}},props:{site:{type:Object,required:!0},isWordpress:{type:Boolean,required:!1,default:!1}},created:function(){this.checkWhetherSuccessWasRecorded()},watch:{site:function(){this.onSiteChange()}},methods:{onSiteChange:function(){this.checkNonce="",this.isTesting=!1,this.isTestComplete=!1,this.isTestSuccess=!1,this.testTimeoutCount=0,this.checkWhetherSuccessWasRecorded()},initiateTrackerTest:function(){var e=this;this.isTesting=!0,this.isTestComplete=!1,this.isTestSuccess=!1,this.testTimeoutCount=0;var t=this.site;p["AjaxHelper"].post({module:"API",method:"JsTrackerInstallCheck.initiateJsTrackerInstallTest"},{idSite:t.id}).then((function(t){var s=t&&t.url&&t.nonce;if(s){e.checkNonce=t.nonce;var n=window.open(t.url);e.setCheckInTime(),setTimeout((function(){n&&!n.closed&&(n.close(),e.testTimeoutCount=T)}),T*k)}}))},setCheckInTime:function(){setTimeout(this.checkWhetherSuccessWasRecorded,k)},checkWhetherSuccessWasRecorded:function(){var e=this,t=this.site,s={idSite:t.id,nonce:""};this.checkNonce&&(s.nonce=this.checkNonce),p["AjaxHelper"].post({module:"API",method:"JsTrackerInstallCheck.wasJsTrackerInstallTestSuccessful"},s).then((function(t){if(e.isTestSuccess=t&&t.isSuccess,e.checkNonce&&!e.isTestSuccess&&e.testTimeoutCount<T)return e.testTimeoutCount+=1,void e.setCheckInTime();e.isTestComplete=!!e.checkNonce,e.isTesting=!1}))}},computed:{getTestFailureMessage:function(){return this.isWordpress?Object(p["translate"])("JsTrackerInstallCheck_JsTrackingCodeInstallCheckFailureMessageWordpress",'<a target="_blank" rel="noreferrer noopener" href="https://wordpress.org/plugins/wp-piwik/">WP-Matomo Integration (WP-Piwik)</a>'):Object(p["translate"])("JsTrackerInstallCheck_JsTrackingCodeInstallCheckFailureMessage")}}});m.render=f;var b=m;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=JsTrackerInstallCheck.umd.min.js.map