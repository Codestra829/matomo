(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue")):"function"===typeof define&&define.amd?define(["CoreHome"],t):"object"===typeof exports?exports["JsTrackerInstallCheck"]=t(require("CoreHome"),require("vue")):e["JsTrackerInstallCheck"]=t(e["CoreHome"],e["Vue"])})("undefined"!==typeof self?self:this,(function(e,t){return function(e){var t={};function s(c){if(t[c])return t[c].exports;var n=t[c]={i:c,l:!1,exports:{}};return e[c].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,c){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:c})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var c=Object.create(null);if(s.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(c,n,function(t){return e[t]}.bind(null,n));return c},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="plugins/JsTrackerInstallCheck/vue/dist/",s(s.s="fae3")}({"19dc":function(t,s){t.exports=e},"8bbf":function(e,s){e.exports=t},fae3:function(e,t,s){"use strict";if(s.r(t),s.d(t,"JsTrackerInstallCheck",(function(){return k})),"undefined"!==typeof window){var c=window.document.currentScript,n=c&&c.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(s.p=n[1])}var i=s("8bbf"),r={class:"jsTrackerInstallCheck"},o={class:"system-success success-message"},a=Object(i["createElementVNode"])("span",{class:"icon-ok"},null,-1),l={class:"system-errors test-error"},u=Object(i["createElementVNode"])("span",{class:"icon-warning"},null,-1);function d(e,t,s,c,n,d){var h=Object(i["resolveComponent"])("ActivityIndicator");return Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],null,[Object(i["createElementVNode"])("li",null,Object(i["toDisplayString"])(e.translate("JsTrackerInstallCheck_TestInstallationDescription")),1),Object(i["createElementVNode"])("div",r,[Object(i["withDirectives"])(Object(i["createElementVNode"])("span",{class:"btn testInstallBtn",onClick:t[0]||(t[0]=function(){return e.initiateTrackerTest&&e.initiateTrackerTest.apply(e,arguments)})},Object(i["toDisplayString"])(e.translate("JsTrackerInstallCheck_TestInstallationBtnText")),513),[[i["vShow"],!e.isTesting&&!e.isTestSuccess]]),Object(i["createVNode"])(h,{loading:e.isTesting,loadingMessage:e.translate("General_Testing")},null,8,["loading","loadingMessage"]),Object(i["withDirectives"])(Object(i["createElementVNode"])("div",o,[a,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("JsTrackerInstallCheck_JsTrackingCodeInstallCheckSuccessMessage")),1)],512),[[i["vShow"],e.isTestSuccess]]),Object(i["withDirectives"])(Object(i["createElementVNode"])("div",l,[u,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("JsTrackerInstallCheck_JsTrackingCodeInstallCheckFailureMessage")),1)],512),[[i["vShow"],e.isTestComplete&&!e.isTestSuccess]])])],64)}var h=s("19dc"),f=10,T=1e3,p=Object(i["defineComponent"])({components:{ActivityIndicator:h["ActivityIndicator"]},data:function(){return{checkNonce:"",isTesting:!1,isTestComplete:!1,isTestSuccess:!1,testTimeoutCount:0}},props:{site:{type:Object,required:!0}},created:function(){this.checkWhetherSuccessWasRecorded()},watch:{site:function(){this.onSiteChange()}},methods:{onSiteChange:function(){this.checkNonce="",this.isTesting=!1,this.isTestComplete=!1,this.isTestSuccess=!1,this.testTimeoutCount=0,this.checkWhetherSuccessWasRecorded()},initiateTrackerTest:function(){var e=this;this.isTesting=!0,this.isTestComplete=!1,this.isTestSuccess=!1,this.testTimeoutCount=0;var t=this.site;h["AjaxHelper"].post({module:"API",method:"JsTrackerInstallCheck.initiateJsTrackerInstallTest"},{idSite:t.id}).then((function(t){var s=t&&t.url&&t.nonce;if(s){e.checkNonce=t.nonce;var c=window.open(t.url);e.setCheckInTime(),setTimeout((function(){c&&!c.closed&&(c.close(),e.testTimeoutCount=f)}),f*T)}}))},setCheckInTime:function(){setTimeout(this.checkWhetherSuccessWasRecorded,T)},checkWhetherSuccessWasRecorded:function(){var e=this,t=this.site,s=this.checkNonce?"checkForJsTrackerInstallTestSuccess":"getJsTrackerInstallTestResult",c={idSite:t.id,nonce:this.checkNonce};this.checkNonce&&(c.nonce=this.checkNonce),h["AjaxHelper"].post({module:"API",method:"JsTrackerInstallCheck.".concat(s)},c).then((function(t){if(e.isTestSuccess=t&&t.isSuccess,e.checkNonce&&!e.isTestSuccess&&e.testTimeoutCount<f)return e.testTimeoutCount+=1,void e.setCheckInTime();e.isTestComplete=!!e.checkNonce,e.isTesting=!1}))}}});p.render=d;var k=p;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=JsTrackerInstallCheck.umd.min.js.map