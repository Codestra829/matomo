(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin"),require("SegmentEditor")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin","SegmentEditor"],t):"object"===typeof exports?exports["PrivacyManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin"),require("SegmentEditor")):e["PrivacyManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"],e["SegmentEditor"])})("undefined"!==typeof self?self:this,(function(e,t,n,a){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="plugins/PrivacyManager/vue/dist/",n(n.s="fae3")}({"0e9f":function(e,t){},"19dc":function(t,n){t.exports=e},"8bbf":function(e,n){e.exports=t},a5a2:function(e,t){e.exports=n},f06f:function(e,t){e.exports=a},fae3:function(e,t,n){"use strict";if(n.r(t),n.d(t,"ManageGdpr",(function(){return ae})),"undefined"!==typeof window){var a=window.document.currentScript,i=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(n.p=i[1])}var l=n("8bbf"),r={class:"manageGdpr"},c={class:"intro"},o=Object(l["createElementVNode"])("br",null,null,-1),s=Object(l["createElementVNode"])("br",null,null,-1),d=Object(l["createElementVNode"])("br",null,null,-1),u=Object(l["createElementVNode"])("br",null,null,-1),b=["innerHTML"],j={class:"form-group row"},m={class:"col s12 input-field"},f={for:"gdprsite",class:"siteSelectorLabel"},g={class:"sites_autocomplete"},v={class:"form-group row segmentFilterGroup"},O={class:"col s12"},p={style:{margin:"8px 0",display:"inline-block"}},S=Object(l["createElementVNode"])("br",null,null,-1),V=Object(l["createTextVNode"])(),h=Object(l["createElementVNode"])("br",null,null,-1),y=Object(l["createElementVNode"])("br",null,null,-1),N=Object(l["createElementVNode"])("br",null,null,-1),E={class:"checkInclude"},D={colspan:"8"},P=["title"],_={class:"checkInclude"},M=["title"],A={class:"visitId"},w={class:"visitorId"},x=["title","onClick"],I={class:"visitorIp"},C=["title","onClick"],T={class:"userId"},k=["title","onClick"],G=["title"],F=["src"],B=["title"],H=["src"],L=["title"],U=["src"],q=["title"],R=["src"],W=["onClick"],$=Object(l["createElementVNode"])("img",{src:"plugins/Live/images/visitorProfileLaunch.png"},null,-1),z={class:"ui-confirm",id:"confirmDeleteDataSubject",ref:"confirmDeleteDataSubject"},J=["value"],Y=["value"];function K(e,t,n,a,i,K){var Q=Object(l["resolveComponent"])("SiteSelector"),X=Object(l["resolveComponent"])("SegmentGenerator"),Z=Object(l["resolveComponent"])("SaveButton"),ee=Object(l["resolveComponent"])("ContentBlock"),te=Object(l["resolveComponent"])("Field"),ne=Object(l["resolveDirective"])("content-table");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",r,[Object(l["createVNode"])(ee,{"content-title":e.translate("PrivacyManager_GdprTools")},{default:Object(l["withCtx"])((function(){return[Object(l["createElementVNode"])("div",c,[Object(l["createElementVNode"])("p",null,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("PrivacyManager_GdprToolsPageIntro1"))+" ",1),o,s,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("PrivacyManager_GdprToolsPageIntro2"))+" ",1),d]),Object(l["createElementVNode"])("ol",null,[Object(l["createElementVNode"])("li",null,Object(l["toDisplayString"])(e.translate("PrivacyManager_GdprToolsPageIntroAccessRight")),1),Object(l["createElementVNode"])("li",null,Object(l["toDisplayString"])(e.translate("PrivacyManager_GdprToolsPageIntroEraseRight")),1)]),Object(l["createElementVNode"])("p",null,[u,Object(l["createElementVNode"])("span",{innerHTML:e.$sanitize(e.overviewHintText)},null,8,b)])]),Object(l["createElementVNode"])("h3",null,Object(l["toDisplayString"])(e.translate("PrivacyManager_SearchForDataSubject")),1),Object(l["createElementVNode"])("div",j,[Object(l["createElementVNode"])("div",m,[Object(l["createElementVNode"])("div",null,[Object(l["createElementVNode"])("label",f,Object(l["toDisplayString"])(e.translate("PrivacyManager_SelectWebsite")),1),Object(l["createElementVNode"])("div",g,[Object(l["createVNode"])(Q,{id:"gdprsite",modelValue:e.site,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.site=t}),"show-all-sites-item":!0,"switch-site-on-select":!1,"show-selected-site":!0},null,8,["modelValue"])])])])]),Object(l["createElementVNode"])("div",v,[Object(l["createElementVNode"])("div",O,[Object(l["createElementVNode"])("div",null,[Object(l["createElementVNode"])("label",p,Object(l["toDisplayString"])(e.translate("PrivacyManager_FindDataSubjectsBy")),1),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(X,{modelValue:e.segment_filter,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.segment_filter=t}),"visit-segments-only":1,idsite:e.site.id},null,8,["modelValue","idsite"])])])])]),Object(l["createVNode"])(Z,{class:"findDataSubjects",value:"Find matching data subjects",onConfirm:t[2]||(t[2]=function(t){return e.findDataSubjects()}),disabled:!e.segment_filter,saving:e.isLoading},null,8,["disabled","saving"])]})),_:1},8,["content-title"]),Object(l["withDirectives"])(Object(l["createElementVNode"])("div",null,[Object(l["createElementVNode"])("h2",null,Object(l["toDisplayString"])(e.translate("PrivacyManager_NoDataSubjectsFound")),1)],512),[[l["vShow"],!e.dataSubjects.length&&e.hasSearched]]),Object(l["withDirectives"])(Object(l["createElementVNode"])("div",null,[Object(l["createElementVNode"])("h2",null,Object(l["toDisplayString"])(e.translate("PrivacyManager_MatchingDataSubjects")),1),Object(l["createElementVNode"])("p",null,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("PrivacyManager_VisitsMatchedCriteria"))+" "+Object(l["toDisplayString"])(e.translate("PrivacyManager_ExportingNote"))+" ",1),S,V,h,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("PrivacyManager_DeletionFromMatomoOnly"))+" ",1),y,N,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("PrivacyManager_ResultIncludesAllVisits")),1)]),Object(l["withDirectives"])(Object(l["createElementVNode"])("table",null,[Object(l["createElementVNode"])("thead",null,[Object(l["createElementVNode"])("tr",null,[Object(l["createElementVNode"])("th",E,[Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(te,{uicontrol:"checkbox",name:"activateAll","model-value":e.toggleAll,"onUpdate:modelValue":t[3]||(t[3]=function(t){e.toggleAll=t,e.toggleActivateAll()}),"full-width":!0},null,8,["model-value"])])]),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Website")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_VisitId")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_VisitorID")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_VisitorIP")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_UserId")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Details")),1),Object(l["withDirectives"])(Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Action")),513),[[l["vShow"],e.profileEnabled]])])]),Object(l["createElementVNode"])("tbody",null,[Object(l["withDirectives"])(Object(l["createElementVNode"])("tr",null,[Object(l["createElementVNode"])("td",D,Object(l["toDisplayString"])(e.translate("PrivacyManager_ResultTruncated","400")),1)],512),[[l["vShow"],e.dataSubjects.length>400]]),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.dataSubjects,(function(t,n){return Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",{title:"".concat(e.translate("PrivacyManager_LastAction"),": ").concat(t.lastActionDateTime),key:n},[Object(l["createElementVNode"])("td",_,[Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(te,{uicontrol:"checkbox",name:"subject".concat(t.idVisit),modelValue:e.dataSubjectsActive[n],"onUpdate:modelValue":function(t){return e.dataSubjectsActive[n]=t},"full-width":!0},null,8,["name","modelValue","onUpdate:modelValue"])])]),Object(l["createElementVNode"])("td",{class:"site",title:"(ID ".concat(t.idSite,")")},Object(l["toDisplayString"])(t.siteName),9,M),Object(l["createElementVNode"])("td",A,Object(l["toDisplayString"])(t.idVisit),1),Object(l["createElementVNode"])("td",w,[Object(l["createElementVNode"])("a",{title:e.translate("PrivacyManager_AddVisitorIdToSearch"),onClick:function(n){return e.addFilter("visitorId",t.visitorId)}},Object(l["toDisplayString"])(t.visitorId),9,x)]),Object(l["createElementVNode"])("td",I,[Object(l["createElementVNode"])("a",{title:e.translate("PrivacyManager_AddVisitorIPToSearch"),onClick:function(n){return e.addFilter("visitIp",t.visitIp)}},Object(l["toDisplayString"])(t.visitIp),9,C)]),Object(l["createElementVNode"])("td",T,[Object(l["createElementVNode"])("a",{title:e.translate("PrivacyManager_AddUserIdToSearch"),onClick:function(n){return e.addFilter("userId",t.userId)}},Object(l["toDisplayString"])(t.userId),9,k)]),Object(l["createElementVNode"])("td",null,[Object(l["createElementVNode"])("span",{title:"".concat(t.deviceType," ").concat(t.deviceModel)},[Object(l["createElementVNode"])("img",{height:"16",src:t.deviceTypeIcon},null,8,F)],8,G),Object(l["createElementVNode"])("span",{title:t.operatingSystem},[Object(l["createElementVNode"])("img",{height:"16",src:t.operatingSystemIcon},null,8,H)],8,B),Object(l["createElementVNode"])("span",{title:"".concat(t.browser," ").concat(t.browserFamilyDescription)},[Object(l["createElementVNode"])("img",{height:"16",src:t.browserIcon},null,8,U)],8,L),Object(l["createElementVNode"])("span",{title:"".concat(t.country," ").concat(t.region)},[Object(l["createElementVNode"])("img",{height:"16",src:t.countryFlag},null,8,R)],8,q)]),Object(l["withDirectives"])(Object(l["createElementVNode"])("td",null,[Object(l["createElementVNode"])("a",{class:"visitorLogTooltip",title:"View visitor profile",onClick:function(n){return e.showProfile(t.visitorId,t.idSite)}},[$,Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(e.translate("Live_ViewVisitorProfile")),1)],8,W)],512),[[l["vShow"],e.profileEnabled]])],8,P)})),128))])],512),[[ne]]),Object(l["createVNode"])(Z,{class:"exportDataSubjects",onConfirm:t[4]||(t[4]=function(t){return e.exportDataSubject()}),disabled:!e.hasActiveDataSubjects,value:e.translate("PrivacyManager_ExportSelectedVisits")},null,8,["disabled","value"]),Object(l["createVNode"])(Z,{class:"deleteDataSubjects",onConfirm:t[5]||(t[5]=function(t){return e.deleteDataSubject()}),disabled:!e.hasActiveDataSubjects||e.isDeleting,value:e.translate("PrivacyManager_DeleteSelectedVisits")},null,8,["disabled","value"])],512),[[l["vShow"],e.dataSubjects.length]]),Object(l["createElementVNode"])("div",z,[Object(l["createElementVNode"])("h2",null,Object(l["toDisplayString"])(e.translate("PrivacyManager_DeleteVisitsConfirm")),1),Object(l["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,J),Object(l["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Y)],512)])}var Q=n("19dc"),X=n("f06f"),Z=n("a5a2"),ee=Object(l["defineComponent"])({components:{ContentBlock:Q["ContentBlock"],SiteSelector:Q["SiteSelector"],SegmentGenerator:X["SegmentGenerator"],SaveButton:Z["SaveButton"],Field:Z["Field"]},directives:{ContentTable:Q["ContentTable"]},data:function(){return{isLoading:!1,isDeleting:!1,site:{id:"all",name:Object(Q["translate"])("UsersManager_AllWebsites")},segment_filter:"userId==",dataSubjects:[],toggleAll:!0,hasSearched:!1,profileEnabled:Q["Matomo"].visitorProfileEnabled,dataSubjectsActive:[]}},setup:function(){var e=Q["AjaxHelper"].fetch({method:"SitesManager.getSitesIdWithAdminAccess",filter_limit:"-1"});return{getSites:function(){return e}}},methods:{showSuccessNotification:function(e){var t=Q["NotificationsStore"].show({message:e,context:"success",id:"manageGdpr",type:"transient"});setTimeout((function(){Q["NotificationsStore"].scrollToNotification(t)}),200)},linkTo:function(e){return"?".concat(Q["MatomoUrl"].stringify(Object.assign(Object.assign({},Q["MatomoUrl"].urlParsed.value),{},{module:"PrivacyManager",action:e})))},toggleActivateAll:function(){this.dataSubjectsActive.fill(this.toggleAll)},showProfile:function(e,t){Q["Matomo"].helper.showVisitorProfilePopup(e,t)},exportDataSubject:function(){var e=this,t=this.activatedDataSubjects;Q["AjaxHelper"].post({module:"API",method:"PrivacyManager.exportDataSubjects",format:"json",filter_limit:-1},{visits:t}).then((function(t){e.showSuccessNotification(Object(Q["translate"])("PrivacyManager_VisitsSuccessfullyExported")),Q["Matomo"].helper.sendContentAsDownload("exported_data_subjects.json",JSON.stringify(t))}))},deleteDataSubject:function(){var e=this;Q["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteDataSubject,{yes:function(){e.isDeleting=!0;var t=e.activatedDataSubjects;Q["AjaxHelper"].post({module:"API",method:"PrivacyManager.deleteDataSubjects",filter_limit:-1},{visits:t}).then((function(){e.dataSubjects=[],e.showSuccessNotification(Object(Q["translate"])("PrivacyManager_VisitsSuccessfullyDeleted")),e.findDataSubjects()})).finally((function(){e.isDeleting=!1}))}})},addFilter:function(e,t){this.segment_filter+=",".concat(e,"==").concat(t),this.findDataSubjects()},findDataSubjects:function(){var e=this;this.dataSubjects=[],this.dataSubjectsActive=[],this.isLoading=!0,this.toggleAll=!0,this.getSites().then((function(t){var n=e.site.id;"all"!==n||Q["Matomo"].hasSuperUserAccess||(n=t,Array.isArray(t)&&(n=t.join(","))),Q["AjaxHelper"].fetch({idSite:n,module:"API",method:"PrivacyManager.findDataSubjects",segment:e.segment_filter}).then((function(t){e.hasSearched=!0,e.dataSubjectsActive=t.map((function(){return!0})),e.dataSubjects=t})).finally((function(){e.isLoading=!1}))}))}},computed:{hasActiveDataSubjects:function(){return!!this.activatedDataSubjects.length},activatedDataSubjects:function(){var e=this;return this.dataSubjects.filter((function(t,n){return e.dataSubjectsActive[n]})).map((function(e){return{idsite:e.idSite,idvisit:e.idVisit}}))},overviewHintText:function(){return Object(Q["translate"])("PrivacyManager_GdprToolsOverviewHint",'<a href="'.concat(this.linkTo("gdprOverview"),'">'),"</a>")}}}),te=n("0e9f"),ne=n.n(te);ee.render=K,"function"===typeof ne.a&&ne()(ee);var ae=ee;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=PrivacyManager.umd.min.js.map